<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:eye="http://jsfcomponents.eyeline.mobi"
      xmlns:smsc="http://taglib.smsc.mobi">

<ui:composition template="/templates/main.xhtml">

  <ui:param name="pageTitle" value="#{msg['smsc.stat.export.title']}"/>

  <ui:define name="styles">
    .labelColumn {width: 1px; text-align:left; white-space: nowrap;}
    .lastColumn {text-align: left; white-space: nowrap;}

    .preprogress {
    width: 2%;
    }

    .progress {
    width: 40%;
    }

    .postprogress {
    width: 58%;
    }

  </ui:define>


  <ui:define name="content">

    <h:form id="export">

      <h:panelGrid style="padding: 10px 10px 10px 10px" columns="2" columnClasses="labelColumn, lastColumn" rendered="#{exportStat.showFilter}">

        <h:outputText value="#{msg['smsc.stat.export.date']}"/>
        <eye:inputDate value="#{exportStat.date}" required="true"/>


        <h:outputText value="#{msg['smsc.stat.export.dest.title']}"/>
        <h:selectOneRadio id="type" value="#{exportStat.type}" onclick="changeType()"  style="width:400px">
          <f:selectItems value="#{exportStat.types}"/>
        </h:selectOneRadio>

        <h:outputText value="#{exportSetBundle.source}"/>
        <h:panelGroup>
          <h:outputText id="def_source" value="#{exportStat.defExportSettings.source}"/>
          <eye:inputText id="cus_source" cols="50" value="#{exportStat.settings.source}"/>
        </h:panelGroup>

        <h:outputText value="#{exportSetBundle.dbType}"/>
        <h:panelGroup>
          <h:outputText id="def_dbType" value="#{exportStat.defExportSettings.dbType}"/>
          <h:selectOneMenu id="cus_dbType" value="#{exportStat.settings.dbType}">
            <f:selectItems value="#{exportStat.dbTypes}"/>
          </h:selectOneMenu>
        </h:panelGroup>

        <h:outputText value="#{exportSetBundle.user}"/>
        <h:panelGroup>
          <h:outputText id="def_user" value="#{exportStat.defExportSettings.user}"/>
          <eye:inputText id="cus_user" value="#{exportStat.settings.user}"/>
        </h:panelGroup>

        <h:outputText value="#{exportSetBundle.pass}"/>
        <h:panelGroup>
          <h:outputText id="def_pass" value="#{exportStat.defExportSettings.pass}"/>
          <eye:inputText secret="true" id="cus_pass" value="#{exportStat.settings.pass}"/>
        </h:panelGroup>

        <h:outputText value="#{exportSetBundle.prefix}"/>
        <h:panelGroup>
          <h:outputText id="def_prefix" value="#{exportStat.defExportSettings.prefix}"/>
          <eye:inputText id="cus_prefix" value="#{exportStat.settings.prefix}"/>
        </h:panelGroup>

      </h:panelGrid>

      <p/>

      <eye:buttons rendered="#{exportStat.showFilter}">
        <eye:button>
          <h:commandLink value="#{msg['smsc.stat.export.button']}" action="#{exportStat.apply}"/>
        </eye:button>
        <eye:button>
          <h:commandLink value="#{msg['clear.button']}" action="#{exportStat.clear}"/>
        </eye:button>
        <eye:space/>
      </eye:buttons>


      <eye:updatableContent updatePeriod="1" enabled="#{exportStat.showProgress}" rendered="#{!exportStat.showFilter}">

        <eye:message level="error" rendered="#{exportStat.error != null}">
          <h:outputText value="#{exportStat.error}"/>
        </eye:message>

        <h:panelGroup style="height: 10px">
          <h:outputText value="&#160;"/>
        </h:panelGroup>

        <h:panelGroup>
          <smsc:pageSubtitle rendered="#{!exportStat.showProgress and exportStat.error == null}" value="#{msg['smsc.stat.export.results']}"/>
          <smsc:pageSubtitle rendered="#{exportStat.showProgress}" value="#{msg['smsc.stat.export.export']} #{exportStat.percents}%"/>
        </h:panelGroup>

        <h:panelGroup rendered="#{exportStat.showResults and exportStat.error == null}">
          <table class="eyeline_list" width="50%">
            <tr>
              <th width="20%"><h:outputText value="&#160;"/></th>
              <th width="40%"><h:outputText value="#{msg['smsc.stat.export.results.records']}"/></th>
              <th width="40%"><h:outputText value="#{msg['smsc.stat.export.results.errors']}"/></th>
            </tr>
            <tr class="eyeline_row0">
              <td><h:outputText value="#{msg['smsc.stat.export.results.total']}"/></td>
              <td><h:outputText value="#{exportStat.results.total.records}"/></td>
              <td><h:outputText value="#{exportStat.results.total.errors}"/></td>
            </tr>
            <tr class="eyeline_row1">
              <td><h:outputText value="#{msg['smsc.stat.export.results.smes']}"/></td>
              <td><h:outputText value="#{exportStat.results.smes.records}"/></td>
              <td><h:outputText value="#{exportStat.results.smes.errors}"/></td>
            </tr>
            <tr class="eyeline_row0">
              <td><h:outputText value="#{msg['smsc.stat.export.results.routes']}"/></td>
              <td><h:outputText value="#{exportStat.results.routes.records}"/></td>
              <td><h:outputText value="#{exportStat.results.routes.errors}"/></td>
            </tr>
          </table>
        </h:panelGroup>

        <p/>

        <eye:buttons rendered="#{exportStat.showResults}">
          <eye:button>
            <h:commandLink value="#{msg['smsc.stat.export.more.button']}" action="#{exportStat.more}"/>
          </eye:button>
          <eye:space/>
        </eye:buttons>


        <h:panelGrid columns="3" style="height: 20px; padding-top: 10px"  columnClasses="preprogress,progress,postprogress">
          <h:outputText value="&#160;"/>
          <eye:progressBar current="#{exportStat.current}" maximum="#{exportStat.total}" rendered="#{exportStat.showProgress}"/>
          <h:outputText value="&#160;"/>
        </h:panelGrid>

      </eye:updatableContent>


    </h:form>

    <script type="text/javascript">
      function changeType() {
        var e = document.getElementById('export:type:0');
        if(e == null) {
          return;
        }
        if(e.checked == 'checked' || e.checked == true) {
          document.getElementById('export:def_source').style.display='';
          document.getElementById('export:def_dbType').style.display='';
          document.getElementById('export:def_user').style.display='';
          document.getElementById('export:def_pass').style.display='';
          document.getElementById('export:def_prefix').style.display='';
          document.getElementById('cus_source').style.display='none';
          document.getElementById('export:cus_dbType').style.display='none';
          document.getElementById('cus_user').style.display='none';
          document.getElementById('cus_pass').style.display='none';
          document.getElementById('cus_prefix').style.display='none';
        }else {
          document.getElementById('export:def_source').style.display='none';
          document.getElementById('export:def_dbType').style.display='none';
          document.getElementById('export:def_user').style.display='none';
          document.getElementById('export:def_pass').style.display='none';
          document.getElementById('export:def_prefix').style.display='none';
          document.getElementById('cus_source').style.display='';
          document.getElementById('export:cus_dbType').style.display='';
          document.getElementById('cus_user').style.display='';
          document.getElementById('cus_pass').style.display='';
          document.getElementById('cus_prefix').style.display='';
        }
      }
      changeType();
    </script>

  </ui:define>

</ui:composition>


</html>
