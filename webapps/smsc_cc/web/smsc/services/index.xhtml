<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:eye="http://jsfcomponents.eyeline.mobi">

<ui:composition template="/templates/main.xhtml">

  <ui:param name="pageTitle" value="#{msg['services.page.title']}"/>

  <ui:define name="styles">
    .statusColumn {white-space: nowrap}

    .editColumn {width: 1%}
    .connectedColumn {width: 1%}
    .systemIdColumn {width: 48%}
    .statusColumn {width: 20%; text-align: center}
    .hostColumn {width: 10%; text-align: center}
    .actionColumn {width: 20%}
  </ui:define>

  <ui:define name="content">

    <h:form id="services" rendered="#{!service.outOfDate}">

      <eye:buttons>
        <eye:button><h:commandLink action="SERVICE_EDIT" value="#{msg['add.button']}"/></eye:button>
        <eye:button><h:commandLink action="#{service.deleteSmes}" value="#{msg['delete.button']}"/></eye:button>
        <eye:space/>
        <eye:button><h:commandLink action="#{service.disconnectSmes}" value="#{msg['services.page.disconnect']}"/></eye:button>
      </eye:buttons>

      <eye:dataTableFilter applyAction="#{service.apply}" clearAction="#{service.clear}">
        <h:panelGrid columns="2" columnClasses="labelColumn, valueColumn" style="width: 300px">
          <h:outputText value="#{msg['service.edit.page.systemId']}"/>
          <eye:inputText value="#{service.nameFilter}"/>
        </h:panelGrid>
      </eye:dataTableFilter>

      <p/>

      <eye:dataTable value="#{service.services}" var="srv" selectedRows="#{service.selectedRows}">

        <eye:row>

          <eye:column name="edit" title="" columnClass="editColumn">
            <h:commandLink action="SERVICE_EDIT" value="#{msg['services.page.edit']}">
              <f:param name="smeId" value="#{srv.systemId}"/>
            </h:commandLink>
          </eye:column>

          <eye:column name="connected" title="" sortable="false" columnClass="connectedColumn">
            <h:graphicImage value="/images/ic_internal.gif" rendered="#{srv.connected}"/>
            <h:graphicImage value="/images/ic_disconnct.gif" rendered="#{not srv.connected}"/>
          </eye:column>

          <eye:column name="systemId" title="#{msg['services.page.systemId']}" sortable="true" columnClass="systemIdColumn" defaultSortOrder="asc">
            <h:outputText value="#{srv.systemId}"/>
          </eye:column>

          <eye:column name="status" title="#{msg['services.page.status']}" columnClass="statusColumn">
            <h:outputText value="LB: #{srv.loadBalancerStatus}" rendered="#{srv.connectedViaLoadBalancer}" style="color: GREEN"/>
            <h:panelGroup rendered="#{srv.connectedDirectly}">
              <c:forEach items="#{srv.directStatuses}" var="st">
                <h:outputText value="SMSC #{st}" style="color:GREEN"/><br/>
              </c:forEach>
            </h:panelGroup>
            <h:outputText value="Internal" rendered="#{srv.internal}" style="color: GREEN"/>
          </eye:column>

          <eye:column name="host" title="#{msg['services.page.host']}" columnClass="hostColumn" >
            <h:outputText value="#{srv.onlineHost}" rendered="#{srv.managed}" style="color:BLUE"/>
          </eye:column>

          <eye:column name="action" title="#{msg['services.page.action']}" columnClass="actionColumn">
            <h:panelGroup rendered="#{srv.managed and !srv.switchAllowed}">
              <h:commandLink value="#{msg['services.page.start']}" action="#{service.startSme}" rendered="#{srv.onlineHost == null}">
                <f:param name="smeId" value="#{srv.systemId}"/>
              </h:commandLink>
              <h:commandLink value="#{msg['services.page.stop']}" action="#{service.stopSme}" rendered="#{srv.onlineHost != null}">
                <f:param name="smeId" value="#{srv.systemId}"/>
              </h:commandLink>
            </h:panelGroup>

            <h:panelGroup rendered="#{srv.managed and srv.switchAllowed}">
              <h:commandLink value="#{msg['services.page.stop']}" action="#{service.stopSme}" rendered="#{srv.onlineHost != null}">
                <f:param name="smeId" value="#{srv.systemId}"/>
              </h:commandLink>
              <h:outputText value=" #{msg['services.page.or']} " rendered="#{srv.onlineHost != null}"/>
              <h:commandLink value="#{msg['services.page.switch_to']}" action="#{service.switchSme}" rendered="#{srv.onlineHost != null}">
                <f:param name="smeId" value="#{srv.systemId}"/>
              </h:commandLink>

              <h:commandLink value="#{msg['services.page.start_at']}" action="#{service.switchSme}" rendered="#{srv.onlineHost == null}">
                <f:param name="smeId" value="#{srv.systemId}"/>
              </h:commandLink>

              <h:outputText value="  "/>

              <h:selectOneMenu value="#{service.switchToHost[srv.systemId]}">
                <f:selectItems value="#{srv.hosts}"/>
              </h:selectOneMenu>
            </h:panelGroup>
          </eye:column>
        </eye:row>

      </eye:dataTable>

      <eye:buttons>
        <eye:button><h:commandLink action="SERVICE_EDIT" value="#{msg['add.button']}"/></eye:button>
        <eye:button><h:commandLink action="#{service.deleteSmes}" value="#{msg['delete.button']}"/></eye:button>
        <eye:space/>
        <eye:button><h:commandLink action="#{service.disconnectSmes}" value="#{msg['services.page.disconnect']}"/></eye:button>
      </eye:buttons>

    </h:form>

  </ui:define>

</ui:composition>


</html>