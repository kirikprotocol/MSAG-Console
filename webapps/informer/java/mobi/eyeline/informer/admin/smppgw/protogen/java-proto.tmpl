package $var proto.package$;

import mobi.eyeline.protogen.framework.*;
import java.io.IOException;

/**
 * This class generated by protogen
 * This protocol has header: len (4 oct), tag (4 oct), seq (4 oct), message body
 */
public class $var protocol.name$ {
  /*
    reader should contain buffer WITHOUT length!!!
  */
  public static PDU decodeMessage( BufferReader reader ) throws IOException {
    int tag = reader.removeInt();
    int seq = reader.removeInt();
    $var protocol.name$Tag t = $var protocol.name$Tag.valueOf(tag);
    if( t == null ) throw new InvalidMessageTypeException();
    PDU pdu = t.createPdu();
    pdu.setSeqNum(seq);
    pdu.decode( reader );
    return pdu;
  }

  public static void encodeMessage( BufferWriter writer, PDU pdu) throws IOException {
    int pos = writer.size();
    writer.appendInt(0); // write 4 bytes for future length
    writer.appendInt(pdu.getTag());
    writer.appendInt(pdu.getSeqNum());
    pdu.encode(writer);
    writer.replaceInt( writer.size()-pos-4, pos ); // fill first 4 bytes with actual length
  }
}
