<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:tr="http://myfaces.apache.org/trinidad"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:eye="http://taglib.eyeline.mobi">

<ui:composition template="/templates/main.xhtml">

  <ui:param name="pageTitle" value="#{msg['informer.admin.deliveries.archive']}"/>

  <ui:define name="content">

    <tr:form>

      <eye:message level="warn" rendered="#{requests.error != null}">
        <h:outputText value="#{requests.error}"/>
      </eye:message>

      <eye:dataTableFilter bean="#{requests}" clearAction="clear" applyAction="query">
        <h:panelGrid columns="4" columnClasses="column50Width, column300Width, column50Width, columnTopLeftAlign">

          <h:outputText style="white-space:nowrap" value="#{msg['archive.request.id']}"/>
          <h:inputText id="id" value="#{requests.id}"
                       validatorMessage="#{msg['invalid_param_value']} #{msg['archive.request.id']}">
            <f:validateLongRange minimum="0"/>
          </h:inputText>

          <h:outputText style="white-space:nowrap" value="#{msg['archive.request.type']}"/>
          <h:selectOneMenu id="type"  value="#{requests.filter.type}" converter="requestTypeConverter">
            <f:selectItem itemLabel="" itemValue=""/>
            <f:selectItems value="#{requests.uniqueTypes}"/>
          </h:selectOneMenu>

          <h:outputText style="white-space:nowrap" value="#{msg['archive.request.name']}"/>
          <h:inputText id="name" value="#{requests.filter.namePrefix}"/>

          <h:outputText style="white-space:nowrap" value="#{msg['archive.request.creator']}" rendered="#{requests.userInAdminRole}"/>
          <h:selectOneMenu rendered="#{requests.userInAdminRole}" id="creator"  value="#{requests.creator}">
            <f:selectItem itemLabel="" itemValue=""/>
            <f:selectItems value="#{requests.uniqueUsers}" />
          </h:selectOneMenu>

        </h:panelGrid>
      </eye:dataTableFilter>

      <eye:delimiter/>

      <eye:buttons>
        <eye:button rendered="#{!requests.offline}">
          <eye:menubar label="#{msg['archive.request.new']} ...">
            <eye:menubaritem><tr:commandLink text="#{msg['informer.admin.deliveries.archive.request.deliveries']}" action="DELIVERIES_REQUEST"/></eye:menubaritem>
            <eye:menubaritem><tr:commandLink text="#{msg['informer.admin.deliveries.archive.request.messages']}" action="MESSAGES_REQUEST"/></eye:menubaritem>
          </eye:menubar>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['archive.request.remove.selected']}" shortDesc="#{msg['archive.request.remove.selected.desc']}" action="#{requests.remove}" onclick="if (!confirm('#{msg['informer.delete.records']}')) return false"/>
        </eye:button>
        <eye:space/>
      </eye:buttons>

      <eye:delimiter/>

      <eye:dataTable value="#{requests.requests}" selectedRows="#{requests.selectedRows}" var="m">
        <eye:row>
          <eye:column name="id" title="#{msg['archive.request.id']}" sortable="true" width="7%" align="center" defaultSortOrder="desc">
            <h:outputText value="#{m.id}"/>
          </eye:column>
          <eye:column name="name" title="#{msg['archive.request.name']}" sortable="true" width="24%" align="left">
            <tr:commandLink text="#{m.name}" action="DELIVERIES_REQUEST" shortDesc="#{msg['archive.request.name.desc']}" rendered="#{m.deliveriesSearch}">
              <f:param name="reqId" value="#{m.id}"/>
            </tr:commandLink>
            <tr:commandLink text="#{m.name}" action="MESSAGES_REQUEST" shortDesc="#{msg['archive.request.name.desc']}" rendered="#{!m.deliveriesSearch}">
              <f:param name="reqId" value="#{m.id}"/>
            </tr:commandLink>
          </eye:column>
          <eye:column name="type" title="#{msg['archive.request.type']}" sortable="true" width="10%" align="left">
            <h:outputText value="#{m.type}" converter="requestTypeStringConverter"/>
          </eye:column>
          <eye:column name="begin" title="#{deliveriesRBundle.from}" sortable="true" width="16%" align="center">
            <h:outputText value="#{m.from}">
              <f:convertDateTime dateStyle="short" type="both" pattern="yyyy.MM.dd HH:mm"/>
            </h:outputText>
          </eye:column>
          <eye:column name="finish" title="#{deliveriesRBundle.till}" width="16%" align="center">
            <h:outputText value="#{m.till}">
              <f:convertDateTime dateStyle="short" type="both" pattern="yyyy.MM.dd HH:mm"/>
            </h:outputText>
          </eye:column>
          <eye:column name="state" title="#{msg['archive.request.state']}" width="17%" align="center">
            <h:outputText value="#{m.status}" converter="requestStatusConverter" rendered="#{!m.inProgress}"/>
            <eye:progressBar fontSize="10" rendered="#{m.inProgress}" current="#{m.progress}" maximum="100" width="150" height="10"/>
          </eye:column>
          <eye:column name="action" title="#{msg['archive.request.action']}" width="10%" align="center">
            <tr:commandLink rendered="#{m.inProgress}" text="#{msg['cancel.button']}" action="#{requests.cancel}"
                            shortDesc="#{msg['archive.request.cancel.desc']}" onclick="if (!confirm('#{msg['archive.request.action.cancel.confirm']}')) return false">
              <f:param name="requestId" value="#{m.id}"/>
            </tr:commandLink>
            <tr:commandLink rendered="#{m.finished and m.deliveriesSearch}" text="#{msg['archive.request.results']}" action="DELIVERIES_RESULTS" shortDesc="#{msg['archive.request.results.desc']}">
              <f:param name="reqId" value="#{m.id}"/>
            </tr:commandLink>
            <tr:commandLink rendered="#{m.finished and !m.deliveriesSearch}" text="#{msg['archive.request.results']}" action="MESSAGES_RESULTS" shortDesc="#{msg['archive.request.results.desc']}">
              <f:param name="reqId" value="#{m.id}"/>
            </tr:commandLink>
          </eye:column>
        </eye:row>
      </eye:dataTable>

      <eye:delimiter/>
      <eye:buttons>
        <eye:button rendered="#{!requests.offline}">
          <eye:menubar label="#{msg['archive.request.new']} ...">
            <eye:menubaritem><tr:commandLink text="#{msg['informer.admin.deliveries.archive.request.deliveries']}" action="DELIVERIES_REQUEST"/></eye:menubaritem>
            <eye:menubaritem><tr:commandLink text="#{msg['informer.admin.deliveries.archive.request.messages']}" action="MESSAGES_REQUEST"/></eye:menubaritem>
          </eye:menubar>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['archive.request.remove.selected']}" shortDesc="#{msg['archive.request.remove.selected.desc']}" action="#{requests.remove}" onclick="if (!confirm('#{msg['informer.delete.records']}')) return false"/>
        </eye:button>
        <eye:space/>
      </eye:buttons>

    </tr:form>

  </ui:define>

</ui:composition>


</html>


