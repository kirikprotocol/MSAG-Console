<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:tr="http://myfaces.apache.org/trinidad"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:eye="http://taglib.eyeline.mobi">

<ui:composition template="/templates/main.xhtml">

  <ui:param name="pageTitle" value="#{msg['delivery.edit']}"/>

  <ui:define name="content">

    <tr:form>

      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{deliveryEdit.save}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="#{deliveryEdit.cancel}" immediate="true"/>
        </eye:button>
        <eye:space/>
        <eye:button>
          <tr:commandLink text="#{msg['informer.stats']}" action="STATS_DELIVERY_MESSAGES_BY_PERIOD">
            <f:param name="delivery" value="#{deliveryEdit.delivery.id}"/>
          </tr:commandLink>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['informer.deliveries.messages']}" action="MESSAGES">
            <f:param name="delivery" value="#{deliveryEdit.delivery.id}"/>
          </tr:commandLink>
        </eye:button>
      </eye:buttons>

      <tr:inputHidden id="delivery" value="#{deliveryEdit.id}"/>
      <tr:inputHidden id="delivery_comeback" value="#{deliveryEdit.comeBackParam}"/>

      <h:panelGrid style="padding:10px" columns="1">

        <tr:panelFormLayout inlineStyle="align:left; width:35%" labelWidth="30%">

          <tr:panelLabelAndMessage label="#{deliveryBundle.name}" labelStyle="text-align:left">
            <tr:inputText readOnly="true" value="#{deliveryEdit.delivery.name}" required="true" simple="true"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.owner}" labelStyle="text-align:left">
            <tr:inputText readOnly="true"  value="#{deliveryEdit.delivery.owner}" required="true" simple="true"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.sourceAddress}" labelStyle="text-align:left">
            <tr:inputText converter="addressConverter" value="#{deliveryEdit.delivery.sourceAddress}" required="true" simple="true"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.activePeriodStart}" labelStyle="text-align:left">
            <t:inputDate value="#{deliveryEdit.delivery.activePeriodStart}" requiredMessage="#{msg['date.required']}" required="true" type="time"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.activePeriodEnd}" labelStyle="text-align:left">
            <t:inputDate value="#{deliveryEdit.delivery.activePeriodEnd}" requiredMessage="#{msg['date.required']}" required="true" type="time"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.activeWeekDays}" labelStyle="text-align:left">
            <h:selectManyCheckbox value="#{deliveryEdit.delivery.activeWeekDays}" required="true" requiredMessage="#{deliveryBundle.activeWeekDays}" converter="weekDaysConverter">
              <f:selectItems value="#{deliveryEdit.allDays}"/>
            </h:selectManyCheckbox>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.startDate}" labelStyle="text-align:left">
            <t:inputDate popupCalendar="true" value="#{deliveryEdit.delivery.startDate}" requiredMessage="#{msg['date.required']}" required="true" type="full"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.endDate}" labelStyle="text-align:left">
            <t:inputDate popupCalendar="true" value="#{deliveryEdit.delivery.endDate}" requiredMessage="#{msg['date.required']}" required="true" type="full"/>
          </tr:panelLabelAndMessage>


          <tr:panelLabelAndMessage label="#{deliveryBundle.validityPeriod}" labelStyle="text-align:left">
            <tr:inputText id="vPeriod" value="#{deliveryEdit.delivery.validityPeriod}" simple="true">
              <tr:validateLongRange minimum="1" maximum="100"/>
            </tr:inputText>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.retryOnFail}" labelStyle="text-align:left">
            <tr:selectBooleanCheckbox id="retryOnFail" value="#{deliveryEdit.delivery.retryOnFail}" simple="true" onchange="
              var e = document.getElementById('retryPolicy1');
              if(this.checked) {
                e.style.display = '';
              }else {
                e.style.display='none';
              }
            "/>
            <h:inputText value="#{deliveryEdit.delivery.retryPolicy}" id="retryPolicy1"
                         style="#{deliveryEdit.delivery.retryOnFail ? '' : 'display:none'}"/>
          </tr:panelLabelAndMessage>


          <tr:panelLabelAndMessage label="#{deliveryBundle.transactionMode}" labelStyle="text-align:left">
            <tr:selectBooleanCheckbox id="trMode" value="#{deliveryEdit.delivery.transactionMode}" simple="true"
                                      onchange="if(document.getElementById('dMode').value != 'SMS') { this.checked = true; }"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.flash}" labelStyle="text-align:left">
            <tr:selectBooleanCheckbox value="#{deliveryEdit.delivery.flash}" simple="true" onchange=""/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.priority}" labelStyle="text-align:left">
            <tr:inputText value="#{deliveryEdit.delivery.priority}" simple="true" required="true">
              <tr:validateLongRange minimum="1" maximum="1000"/>
            </tr:inputText>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.deliveryMode}" labelStyle="text-align:left">
            <h:selectOneMenu id="dMode" value="#{deliveryEdit.delivery.deliveryMode}" required="true" converter="deliveryTypeConverter"
                             onchange="if(this.value != 'SMS') {document.getElementById('trMode').checked = true;}">
              <f:selectItems value="#{deliveryEdit.uniqueDeliveryModes}"/>
            </h:selectOneMenu>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.smsNotificationAddress}" labelStyle="text-align:left">
            <tr:inputText converter="addressConverter" value="#{deliveryEdit.delivery.smsNotificationAddress}" simple="true"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.emailNotificationAddress}" labelStyle="text-align:left">
            <tr:inputText value="#{deliveryEdit.delivery.emailNotificationAddress}" simple="true"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.singleText}" labelStyle="text-align:left" rendered="#{deliveryEdit.delivery.type.value == 'SingleText'}">
            <tr:inputText value="#{deliveryEdit.delivery.singleText}"  simple="true" required="true"/>
            <tr:outputText value="&#160;"/>
            <tr:commandLink text="#{msg['test.button']}" action="#{deliveryEdit.sendTest}"/>
          </tr:panelLabelAndMessage>

          <tr:panelLabelAndMessage label="#{deliveryBundle.secretMessage}" labelStyle="text-align:left" rendered="#{deliveryEdit.delivery.secret}">
            <tr:inputText rows="5" readOnly="true" value="#{deliveryEdit.delivery.secretMessage}"  simple="true"/>
          </tr:panelLabelAndMessage>

        </tr:panelFormLayout>

      </h:panelGrid>

      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{deliveryEdit.save}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="#{deliveryEdit.cancel}" immediate="true"/>
        </eye:button>
        <eye:space/>
        <eye:button>
          <tr:commandLink text="#{msg['informer.stats']}" action="STATS_DELIVERY_MESSAGES_BY_PERIOD">
            <f:param name="delivery" value="#{deliveryEdit.delivery.id}"/>
          </tr:commandLink>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['informer.deliveries.messages']}" action="MESSAGES">
            <f:param name="delivery" value="#{deliveryEdit.delivery.id}"/>
          </tr:commandLink>
        </eye:button>
      </eye:buttons>

    </tr:form>

  </ui:define>

</ui:composition>


</html>
