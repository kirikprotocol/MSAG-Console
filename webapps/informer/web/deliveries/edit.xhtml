<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:tr="http://myfaces.apache.org/trinidad"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:eye="http://taglib.eyeline.mobi">

<ui:composition template="/templates/main.xhtml">

  <ui:param name="pageTitle" value="#{msg['delivery.edit']}"/>

  <ui:define name="content">

    <tr:form>

      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{deliveryEdit.save}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="#{deliveryEdit.cancel}" immediate="true"/>
        </eye:button>
        <eye:space/>
        <eye:button>
          <tr:commandLink text="#{msg['informer.stats']}" action="STATS_DELIVERY_MESSAGES_BY_PERIOD">
            <f:param name="delivery" value="#{deliveryEdit.delivery.id}"/>
          </tr:commandLink>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['informer.deliveries.messages']}" action="MESSAGES">
            <f:param name="delivery" value="#{deliveryEdit.delivery.id}"/>
          </tr:commandLink>
        </eye:button>
      </eye:buttons>

      <tr:inputHidden id="delivery" value="#{deliveryEdit.id}"/>
      <tr:inputHidden id="delivery_comeback" value="#{deliveryEdit.comeBackParam}"/>

      <eye:delimiter/>

      <h:panelGrid columns="2" style="padding-left: 10px" columnClasses="column100Width, columnTopLeftAlign">

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.name}"/>
        <tr:inputText value="#{deliveryEdit.delivery.name}" required="true" simple="true"/>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.owner}" rendered="#{deliveryEdit.userInAdminRole}"/>
        <h:outputText value="#{deliveryEdit.delivery.owner}" rendered="#{deliveryEdit.userInAdminRole}"/>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.sourceAddress}"/>
        <tr:inputText converter="addressConverter" value="#{deliveryEdit.delivery.sourceAddress}" required="true" simple="true"/>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.startDate}"/>
        <tr:outputText value="#{deliveryEdit.delivery.startDate}">
          <f:convertDateTime dateStyle="short" type="both"/>
        </tr:outputText>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.endDate}"/>
        <eye:inputDate value="#{deliveryEdit.delivery.endDate}" type="both"/>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.activeWeekDays}"/>
        <h:panelGrid columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:selectManyCheckbox value="#{deliveryEdit.delivery.activeWeekDays}" required="true" requiredMessage="#{deliveryBundle.activeWeekDays}" converter="weekDaysConverter">
            <f:selectItems value="#{deliveryEdit.allDays}"/>
          </h:selectManyCheckbox>
          <h:outputText value="&#160;"/>
        </h:panelGrid>

        <h:outputText style="white-space:nowrap;" value="#{msg['delivery.edit.activity.period']}"/>
        <h:panelGroup>
          <eye:inputDate value="#{deliveryEdit.activePeriodStart}" required="true" type="short_time"/>
          <h:outputText value=" - "/>
          <eye:inputDate value="#{deliveryEdit.activePeriodEnd}" required="true" type="short_time"/>
        </h:panelGroup>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.priority}"/>
        <tr:inputText value="#{deliveryEdit.delivery.priority}" simple="true" required="true" columns="5">
          <tr:validateLongRange minimum="1" maximum="1000"/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.retryOnFail}"/>
        <h:panelGroup>
          <h:selectBooleanCheckbox id="retryOnFail" value="#{deliveryEdit.delivery.retryOnFail}"
                                    style="position: relative; top: 2px; left: -3px;"
                                    onchange="document.getElementById('retryPolicy1').disabled = !this.checked;"/>
          <h:inputText value="#{deliveryEdit.delivery.retryPolicy}" id="retryPolicy1"/>
        </h:panelGroup>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.smsNotificationAddress}"/>
        <h:panelGroup>
          <h:selectBooleanCheckbox id="smsNotif" value="#{deliveryEdit.smsNotificationCheck}" onchange="document.getElementById('sms').disabled = !this.checked;" style="position: relative; top: 2px; left: -3px;"/>
          <tr:inputText id="sms" converter="addressConverter" value="#{deliveryEdit.smsNotificationAddress}" simple="true"/>
        </h:panelGroup>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.emailNotificationAddress}"/>
        <h:panelGroup>
          <h:selectBooleanCheckbox id="emailNotif" value="#{deliveryEdit.emailNotificationCheck}" onchange="document.getElementById('email').disabled = !this.checked;" style="position: relative; top: 2px; left: -3px;"/>
          <tr:inputText id="email" value="#{deliveryEdit.emailNotificationAddress}" simple="true"/>
        </h:panelGroup>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.singleText}" rendered="#{deliveryEdit.delivery.type.value == 'SingleText'}"/>
        <h:panelGrid columns="1" rendered="#{deliveryEdit.delivery.type.value == 'SingleText'}">
          <tr:inputText value="#{deliveryEdit.delivery.singleText}" rows="3" simple="true" required="true"/>
          <tr:commandLink text="#{msg['test.button']}" action="#{deliveryEdit.sendTest}"/>
        </h:panelGrid>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.secretMessage}" rendered="#{deliveryEdit.secret}"/>
        <tr:inputText rows="5" readOnly="true" value="#{deliveryEdit.secretMessage}"  simple="true" rendered="#{deliveryEdit.secret}"/>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.secretFlash}" rendered="#{deliveryEdit.secret}"/>
        <tr:selectBooleanCheckbox readOnly="true" value="#{deliveryEdit.flashSecret}" simple="true" rendered="#{deliveryEdit.secret}"/>
      
        <h:outputText style="white-space:nowrap; display: #{deliveryEdit.allowUssdPushDeliveries ? '' : 'none'}" value="#{deliveryBundle.deliveryMode}"/>
        <h:selectOneMenu id="dMode" value="#{deliveryEdit.delivery.deliveryMode}" required="true" converter="deliveryTypeConverter"
                         onchange="var d = (this.value != 'SMS') ? 'none' : ''; document.getElementById('smsSettings').style.display = d;"
                         style="display: #{deliveryEdit.allowUssdPushDeliveries ? '' : 'none'}">
          <f:selectItems value="#{deliveryEdit.uniqueDeliveryModes}"/>
        </h:selectOneMenu>
      </h:panelGrid>

      <h:panelGrid id="smsSettings" columns="2" columnClasses="column100Width, columnTopLeftAlign" style="padding-left:10px; display: #{deliveryEdit.smsMode ? '' : 'none'}">

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.flash}"/>
        <tr:selectBooleanCheckbox value="#{deliveryEdit.delivery.flash}" simple="true"/>

        <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.transactionMode}"/>
        <tr:selectBooleanCheckbox id="trMode" value="#{deliveryEdit.delivery.transactionMode}" simple="true"
            onchange="
                var d = this.checked ? 'none' : '';
                document.getElementById('vPeriodLabel').style.display=d;
                document.getElementById('vPeriod').style.display=d;
            "/>

        <h:outputText id="vPeriodLabel" style="white-space:nowrap;" value="#{deliveryBundle.validityPeriod}"/>
        <eye:inputDate id="vPeriod" value="#{deliveryEdit.validityPeriod}" type="short_time"/>

      </h:panelGrid>

      <eye:delimiter/>

      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{deliveryEdit.save}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="#{deliveryEdit.cancel}" immediate="true"/>
        </eye:button>
        <eye:space/>
        <eye:button>
          <tr:commandLink text="#{msg['informer.stats']}" action="STATS_DELIVERY_MESSAGES_BY_PERIOD">
            <f:param name="delivery" value="#{deliveryEdit.delivery.id}"/>
          </tr:commandLink>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['informer.deliveries.messages']}" action="MESSAGES">
            <f:param name="delivery" value="#{deliveryEdit.delivery.id}"/>
          </tr:commandLink>
        </eye:button>
      </eye:buttons>

      <script type="text/javascript" language="javascript">
        document.getElementById('retryPolicy1').disabled = !document.getElementById('retryOnFail').checked;
        var d = document.getElementById('trMode').checked ? 'none' : '';
        document.getElementById('vPeriodLabel').style.display=d;        
        document.getElementById('vPeriod').style.display=d;

        document.getElementById('sms').disabled = !document.getElementById('smsNotif').checked;
        document.getElementById('email').disabled = !document.getElementById('emailNotif').checked;
      </script>

    </tr:form>

  </ui:define>

</ui:composition>


</html>