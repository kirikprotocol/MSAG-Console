<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:tr="http://myfaces.apache.org/trinidad"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:eye="http://taglib.eyeline.mobi">

<ui:composition template="/templates/main.xhtml">

  <ui:param name="pageTitle" value="#{msg['informer.deliveries.list']}"/>

  <ui:define name="content">
    <tr:form>

      <h:inputHidden value="#{deliveries.init}"/>


      <eye:dataTableFilter bean="#{deliveries}" clearAction="clearFilter" applyAction="query">
        <h:panelGrid columns="6" columnClasses="column50WidthNoWrap, column300Width, column50WidthNoWrap, column300Width,column50WidthNoWrap, columnTopLeftAlign">

          <h:outputText style="white-space:nowrap;" value="#{msg['stat.page.from_date']}"/>
          <eye:inputDate value="#{deliveries.startDateFrom}" type="both" />

          <h:outputText value="#{deliveryBundle.name}"/>
          <h:inputText value="#{deliveries.namePrefix}"/>

          <h:outputText value="#{deliveryBundle.owner}" rendered="#{deliveries.userInAdminRole}"/>
          <h:selectOneMenu value="#{deliveries.userFilter}" rendered="#{deliveries.userInAdminRole}">
            <f:selectItems value="#{deliveries.uniqueUsers}"/>
          </h:selectOneMenu>
          <h:outputText value="&#160;" rendered="#{!deliveries.userInAdminRole}"/>
          <h:outputText value="&#160;" rendered="#{!deliveries.userInAdminRole}"/>

          <h:outputText style="white-space:nowrap;" value="#{msg['stat.page.till_date']}"/>
          <eye:inputDate value="#{deliveries.startDateTo}" type="both"/>

          <h:outputText value="#{msg['delivery.status']}"/>
          <h:selectOneMenu value="#{deliveries.status}" >
            <f:selectItems value="#{deliveries.uniqueStatuses}"/>
          </h:selectOneMenu>

          <h:outputText value="#{deliveryBundle.id}"/>
          <tr:inputText columns="10" value="#{deliveries.idFilter}" simple="true">
            <tr:validateLongRange minimum="0"/>
          </tr:inputText>

        </h:panelGrid>
      </eye:dataTableFilter>

      <h:panelGroup style="display: #{deliveries.init ? '' : 'none'}">
        <eye:delimiter/>
        <eye:buttons>
          <eye:button>
            <tr:commandLink text="#{msg['create.button']}" action="DELIVERY_CREATE" shortDesc="#{msg['delivery.details.create']}"/>
          </eye:button>
          <eye:button>
            <eye:menubar label="#{msg['informer.deliveries.selected']}...">
              <eye:menubaritem><tr:commandLink text="#{msg['activate.button']}" action="#{deliveries.activate}" onclick="if (!confirm('#{msg['informer.deliveries.activate.confirm']}')) return false"/></eye:menubaritem>
              <eye:menubaritem><tr:commandLink text="#{msg['pause.button']}" action="#{deliveries.pause}" onclick="if (!confirm('#{msg['informer.deliveries.pause.confirm']}')) return false"/></eye:menubaritem>
              <eye:menubaritem><tr:commandLink text="#{msg['edit.button']}" action="#{deliveries.editGroup}"/></eye:menubaritem>
              <eye:menubaritem><tr:commandLink text="#{msg['delete.button']}" action="#{deliveries.delete}" onclick="if (!confirm('#{msg['informer.delete.records']}')) return false"/></eye:menubaritem>
              <eye:menubaritem rendered="#{deliveries.archivationAllowed}"><tr:commandLink text="#{msg['archivate.button']}" action="#{deliveries.archivate}" onclick="if (!confirm('#{msg['informer.archivate.records']}')) return false"/></eye:menubaritem>
              <eye:menubaritem>
                <tr:commandLink text="#{msg['informer.stats']}" action="#{deliveryMessagesByPeriod.setDeliveryParam}" actionListener="#{deliveries.statForSelected}"/>
              </eye:menubaritem>
            </eye:menubar>
          </eye:button>
          <eye:space/>
        </eye:buttons>
      </h:panelGroup>

      <eye:delimiter/>

      <eye:dataTable value="#{deliveries.deliviries}" var="m" rendered="#{deliveries.init}" selectedRows="#{deliveries.selected}">
        <eye:row>
          <eye:column name="id" title="#{deliveryBundle.id}" sortable="true" width="5%" align="center">
            <h:outputText value="#{m.id}"/>
          </eye:column>
          <eye:column name="name" title="#{deliveryBundle.name}" sortable="true" width="19%">
            <tr:commandLink text="#{m.name}" action="DELIVERY_EDIT"  shortDesc="#{msg['delivery.details.show']}">
              <f:param name="#{deliveries.deliveryParam}" value="#{m.deliveryId}"/>
              <f:param name="init" value="#{deliveries.init}"/>
            </tr:commandLink>
          </eye:column>
          <eye:column name="userId" title="#{deliveryBundle.owner}" sortable="true" width="19%" align="center">
            <h:outputText value="#{m.userId}"/>
          </eye:column>
          <eye:column name="status" title="#{msg['delivery.status']}" sortable="true" width="19%" align="center">

            <tr:panelBorderLayout
                shortDesc="#{msg['message.state.New']}: #{m.newMessages+m.processMessages+m.retriedMessages}; #{msg['message.state.Sent']}:  #{m.sentMessages}; #{msg['message.state.Delivered']}: #{m.deliveredMessages}; #{msg['message.state.Failed']}: #{m.failedMessages}; #{msg['message.state.Expired']}:  #{m.expiredMessages}">

              <eye:status status="#{m.status.stringValue}" rendered="#{!m.renderProgress}"/>

              <eye:progressBar fontSize="10" rendered="#{m.renderProgress}" current="#{m.finalized}" maximum="#{m.total}" width="150" height="10"/>

            </tr:panelBorderLayout>

          </eye:column>
          <eye:column name="startDate" title="#{deliveryBundle.startDate}" width="19%" align="center" sortable="true">
            <tr:outputText value="#{m.startDate}">
              <f:convertDateTime dateStyle="short" type="both"/>
            </tr:outputText>
          </eye:column>
          <eye:column name="endDate" title="#{deliveryBundle.endDate}" width="19%" align="center">
            <tr:outputText value="#{m.endDate}" rendered="#{m.endDate != null}">
              <f:convertDateTime dateStyle="short" type="both"/>
            </tr:outputText>
            <h:outputText value="&#160;" rendered="#{m.endDate == null}"/>
          </eye:column>
        </eye:row>
      </eye:dataTable>

      <h:panelGroup style="display: #{deliveries.init ? '' : 'none'}">
        <eye:delimiter/>
        <eye:buttons>
          <eye:button>
            <tr:commandLink text="#{msg['create.button']}" action="DELIVERY_CREATE" shortDesc="#{msg['delivery.details.create']}"/>
          </eye:button>
          <eye:button>
            <eye:menubar label="#{msg['informer.deliveries.selected']} ...">
              <eye:menubaritem><tr:commandLink text="#{msg['activate.button']}" action="#{deliveries.activate}" onclick="if (!confirm('#{msg['informer.deliveries.activate.confirm']}')) return false"/></eye:menubaritem>
              <eye:menubaritem><tr:commandLink text="#{msg['pause.button']}" action="#{deliveries.pause}" onclick="if (!confirm('#{msg['informer.deliveries.pause.confirm']}')) return false"/></eye:menubaritem>
              <eye:menubaritem><tr:commandLink text="#{msg['edit.button']}" action="#{deliveries.editGroup}"/></eye:menubaritem>
              <eye:menubaritem><tr:commandLink text="#{msg['delete.button']}" action="#{deliveries.delete}" onclick="if (!confirm('#{msg['informer.delete.records']}')) return false"/></eye:menubaritem>
              <eye:menubaritem rendered="#{deliveries.archivationAllowed}"><tr:commandLink text="#{msg['archivate.button']}" action="#{deliveries.archivate}" onclick="if (!confirm('#{msg['informer.archivate.records']}')) return false"/></eye:menubaritem>
              <eye:menubaritem>
                <tr:commandLink text="#{msg['informer.stats']}" action="#{deliveryMessagesByPeriod.setDeliveryParam}" actionListener="#{deliveries.statForSelected}"/>
              </eye:menubaritem>
            </eye:menubar>
          </eye:button>
          <eye:space/>
        </eye:buttons>
        <div style="height:70px;"></div>
      </h:panelGroup>

    </tr:form>
  </ui:define>

</ui:composition>


</html>
