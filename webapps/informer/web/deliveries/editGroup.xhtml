<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:tr="http://myfaces.apache.org/trinidad"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:eye="http://taglib.eyeline.mobi">

<ui:composition template="/templates/main.xhtml">

<ui:param name="pageTitle" value="#{msg['delivery.edit.group']}"/>

<ui:define name="content">

<tr:form>

  <h:panelGroup rendered="#{deliveryGroupEdit.ids != null}">

    <eye:buttons>
      <eye:button>
        <tr:commandLink text="#{msg['done.button']}" action="#{deliveryGroupEdit.save}" shortDesc="#{msg['deliveries.details.save']}"/>
      </eye:button>
      <eye:button>
        <tr:commandLink text="#{msg['cancel.button']}" action="DELIVERIES" immediate="true" shortDesc="#{msg['delivery.details.cancel']}"/>
      </eye:button>
      <eye:space/>
    </eye:buttons>

    <t:saveState value="#{deliveryGroupEdit.ids}"/>

    <eye:delimiter/>

    <h:panelGrid style="padding-left:10px; padding-top:10px" columns="3" columnClasses="column20Width,column100WidthNoWrap, columnTopLeftAlign">

      <h:selectBooleanCheckbox id="editSourceAddr" value="#{deliveryGroupEdit.editSourceAddress}" onchange="document.getElementById('sourceAddr').disabled=!this.checked"/>
      <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.sourceAddress}"/>
      <h:inputText converterMessage="#{msg['invalid_param_value']} #{deliveryBundle.sourceAddress}"
                   id="sourceAddr" value="#{deliveryGroupEdit.sourceAddress}" size="15" converter="addressConverter"/>

      <h:selectBooleanCheckbox id="editDeliveryDays" value="#{deliveryGroupEdit.editActiveWeekDays}" onchange="
          for (var i = 0; i&lt;7; i++)
            document.getElementById('deliveryDays:' + i).disabled=!this.checked
          "/>
      <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.activeWeekDays}"/>
      <h:selectManyCheckbox id="deliveryDays" value="#{deliveryGroupEdit.activeWeekDays}" style="width: 100px" >
        <f:selectItems value="#{deliveryGroupEdit.allDays}"/>
      </h:selectManyCheckbox>

      <h:selectBooleanCheckbox id="editEndDate" value="#{deliveryGroupEdit.editEndDate}" onchange="
          document.getElementById('endDate.day').disabled=!this.checked;
          document.getElementById('endDate.month').disabled=!this.checked;
          document.getElementById('endDate.year').disabled=!this.checked;
          document.getElementById('endDate.hours').disabled=!this.checked;
          document.getElementById('endDate.minutes').disabled=!this.checked;
          "/>
      <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.endDate}"/>
      <eye:inputDate id="endDate" value="#{deliveryGroupEdit.endDate}" type="both"/>


      <h:selectBooleanCheckbox rendered="#{deliveryGroupEdit.userInAdminRole}" id="editDeliveryStartTime" value="#{deliveryGroupEdit.editActivePeriodStart}" onchange="
          document.getElementById('deliveryStartTime.hours').disabled=!this.checked;
          document.getElementById('deliveryStartTime.minutes').disabled=!this.checked"
          />
      <h:outputText rendered="#{deliveryGroupEdit.userInAdminRole}" style="white-space:nowrap;" value="#{deliveryBundle.activePeriodStart}"/>
      <eye:inputDate rendered="#{deliveryGroupEdit.userInAdminRole}" id="deliveryStartTime" value="#{deliveryGroupEdit.activePeriodStart}" type="short_time"/>

      <h:selectBooleanCheckbox rendered="#{deliveryGroupEdit.userInAdminRole}" id="editDeliveryEndTime" value="#{deliveryGroupEdit.editActivePeriodEnd}" onchange="
          document.getElementById('deliveryEndTime.hours').disabled=!this.checked;
          document.getElementById('deliveryEndTime.minutes').disabled=!this.checked;
          "/>
      <h:outputText rendered="#{deliveryGroupEdit.userInAdminRole}" style="white-space:nowrap;" value="#{deliveryBundle.activePeriodEnd}"/>
      <eye:inputDate rendered="#{deliveryGroupEdit.userInAdminRole}" id="deliveryEndTime" value="#{deliveryGroupEdit.activePeriodEnd}" type="short_time"/>

      <h:selectBooleanCheckbox rendered="#{deliveryGroupEdit.userInAdminRole}" id="editPriority" value="#{deliveryGroupEdit.editPriority}" onchange="document.getElementById('priority').disabled=!this.checked"/>
      <h:outputText rendered="#{deliveryGroupEdit.userInAdminRole}" style="white-space:nowrap;" value="#{deliveryBundle.priority}"/>
      <h:inputText rendered="#{deliveryGroupEdit.userInAdminRole}" converterMessage="#{msg['invalid_param_value']} #{deliveryBundle.priority}" id="priority" value="#{deliveryGroupEdit.priority}" size="3"/>

      <h:selectBooleanCheckbox rendered="#{deliveryGroupEdit.userInAdminRole}" id="editRetryPolicy" value="#{deliveryGroupEdit.editRetryPolicy}" onchange="
          document.getElementById('retryPolicy').disabled=!this.checked;
          document.getElementById('retryOnFail').disabled=!this.checked;
          "/>
      <h:outputText rendered="#{deliveryGroupEdit.userInAdminRole}" style="white-space:nowrap;" value="#{deliveryBundle.retryPolicy}"/>
      <h:panelGroup rendered="#{deliveryGroupEdit.userInAdminRole}">
        <h:selectOneMenu id="retryOnFail" onchange="retryOnFailChanged()" value="#{deliveryGroupEdit.retryOnFail}">
            <f:selectItem itemValue="off" itemLabel="#{msg['user.edit.retry.off']}"/>
            <f:selectItem itemValue="default" itemLabel="#{msg['user.edit.retry.default']}"/>
            <f:selectItem itemValue="custom" itemLabel="#{msg['user.edit.retry.custom']}"/>
          </h:selectOneMenu>
        <h:outputText value=" "/>
        <h:inputText id="retryPolicy" value="#{deliveryGroupEdit.retryPolicy}" />
      </h:panelGroup>

      <h:selectBooleanCheckbox rendered="#{deliveryGroupEdit.userInAdminRole}" id="editValidHours" value="#{deliveryGroupEdit.editValidityPeriod}"
                               onchange="
                                   document.getElementById('validityPeriod.hours').disabled=!this.checked;
                                   document.getElementById('validityPeriod.minutes').disabled=!this.checked;
                                   "/>
      <h:outputText rendered="#{deliveryGroupEdit.userInAdminRole}" id="validHoursLabel" style="white-space:nowrap;" value="#{deliveryBundle.validityPeriod}"/>
      <eye:inputTime rendered="#{deliveryGroupEdit.userInAdminRole}" id="validityPeriod" value="#{deliveryGroupEdit.validityPeriod}"/>


      <h:selectBooleanCheckbox id="editSmsNotification" value="#{deliveryGroupEdit.editSmsNotification}" onchange="document.getElementById('smsNotification').disabled=!this.checked"/>
      <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.smsNotificationAddress}"/>
      <h:inputText converterMessage="#{msg['invalid_param_value']} #{deliveryBundle.smsNotificationAddress}"
                   id="smsNotification" value="#{deliveryGroupEdit.smsNotification}" converter="addressConverter"/>

      <h:selectBooleanCheckbox id="editEmailNotification" value="#{deliveryGroupEdit.editEmailNotification}" onchange="document.getElementById('emailNotification').disabled=!this.checked"/>
      <h:outputText style="white-space:nowrap;" value="#{deliveryBundle.emailNotificationAddress}"/>
      <tr:inputText id="emailNotification" value="#{deliveryGroupEdit.emailNotification}" simple="true" />

      <h:selectBooleanCheckbox id="editDeliveryType" value="#{deliveryGroupEdit.editDeliveryMode}" onchange="document.getElementById('deliveryType').disabled=!this.checked" style="display:#{deliveryGroupEdit.allowUssdPushDeliveries ? '' : 'none'}"/>
      <h:outputText style="white-space:nowrap;display: #{deliveryGroupEdit.allowUssdPushDeliveries ? '' : 'none'}" value="#{deliveryBundle.deliveryMode}" />
      <h:selectOneMenu id="deliveryType" value="#{deliveryGroupEdit.deliveryMode}" style="align:left;display: #{deliveryGroupEdit.allowUssdPushDeliveries ? '' : 'none'}"  onchange="
          var dt = document.getElementById('deliveryType');
          var disp = dt.options[0].selected ? '' : 'none';
          displaySmsSettings(disp);
          if(!dt.options[0].selected ) {
            document.getElementById('editFlash').checked = false;
            var e = document.getElementById('editTransactionMode');
            if(e != null) {
              e.checked = false;
            }
            document.getElementById('flash').disabled=true;
            e = document.getElementById('transactionMode');
            if(e != null) {
              e.disabled=true;
            }
          }
          ">
        <f:selectItems value="#{deliveryGroupEdit.uniqueDeliveryModes}"/>
      </h:selectOneMenu>


      <h:selectBooleanCheckbox id="editFlash" value="#{deliveryGroupEdit.editFlash}" onchange="
          document.getElementById('flash').disabled=!this.checked;
          "/>
      <h:outputText id="editFlashLabel" style="white-space:nowrap;" value="#{deliveryBundle.flash}"/>
      <tr:selectBooleanCheckbox id="flash" value="#{deliveryGroupEdit.flash}" simple="true"/>

      <h:selectBooleanCheckbox rendered="#{deliveryGroupEdit.userInAdminRole}" id="editTransactionMode" value="#{deliveryGroupEdit.editTransactionMode}" onchange="document.getElementById('transactionMode').disabled=!this.checked"/>
      <h:outputText id="editTransactionModeLabel" rendered="#{deliveryGroupEdit.userInAdminRole}" style="white-space:nowrap;" value="#{deliveryBundle.transactionMode}"/>
      <h:selectBooleanCheckbox rendered="#{deliveryGroupEdit.userInAdminRole}" id="transactionMode" value="#{deliveryGroupEdit.transactionMode}"/>

    </h:panelGrid>

    <eye:delimiter/>

    <eye:buttons>
      <eye:button>
        <tr:commandLink text="#{msg['done.button']}" action="#{deliveryGroupEdit.save}" shortDesc="#{msg['deliveries.details.save']}"/>
      </eye:button>
      <eye:button>
        <tr:commandLink text="#{msg['cancel.button']}" action="DELIVERIES" immediate="true" shortDesc="#{msg['delivery.details.cancel']}"/>
      </eye:button>
      <eye:space/>
    </eye:buttons>

    <script type="text/javascript" language="javascript">

      function displaySmsSettings(d) {
        document.getElementById('editFlash').style.display=d;
        document.getElementById('editFlashLabel').style.display=d;
        document.getElementById('flash').style.display=d;
        var e  = document.getElementById('editTransactionMode');
        if(e != null) {
         e.style.display = d;
        document.getElementById('editTransactionModeLabel').style.display=d;
        document.getElementById('transactionMode').style.display=d;
        }
      }

      function retryOnFailChanged() {
        var e = document.getElementById('retryOnFail');
        if( e != null ) {
          var d = e.options[2].selected ? '' : 'none';
          document.getElementById('retryPolicy').style.display=d;
        }
      }

      retryOnFailChanged();

      document.getElementById('sourceAddr').disabled = !document.getElementById('editSourceAddr').checked;

      var deliveryDaysDisabled = !document.getElementById('editDeliveryDays').checked;
      for (var i = 0; i&lt;7; i++)
        document.getElementById('deliveryDays:' + i).disabled=deliveryDaysDisabled;

      var e = document.getElementById('editDeliveryStartTime');
      if(e != null){
        var deliveryStartTimeDisabled = !e.checked;
        document.getElementById('deliveryStartTime.hours').disabled=deliveryStartTimeDisabled;
        document.getElementById('deliveryStartTime.minutes').disabled=deliveryStartTimeDisabled;
      }
      var endDateDisabled = !document.getElementById('editEndDate').checked;
      document.getElementById('endDate.day').disabled=endDateDisabled;
      document.getElementById('endDate.month').disabled=endDateDisabled;
      document.getElementById('endDate.year').disabled=endDateDisabled;
      document.getElementById('endDate.hours').disabled=endDateDisabled;
      document.getElementById('endDate.minutes').disabled=endDateDisabled;

      e = document.getElementById('editDeliveryEndTime');
      if(e != null) {
        var deliveryEndTimeDisabled = !e.checked;
        document.getElementById('deliveryEndTime.hours').disabled=deliveryEndTimeDisabled;
        document.getElementById('deliveryEndTime.minutes').disabled=deliveryEndTimeDisabled;
      }
      e = document.getElementById('priority');
      if( e != null) {
        e.disabled = !document.getElementById('editPriority').checked;
      }
      e = document.getElementById('editRetryPolicy');
      if(e != null) {
        var retryPolicyDisabled = !e.checked;
        document.getElementById('retryPolicy').disabled=retryPolicyDisabled;
        document.getElementById('retryOnFail').disabled=retryPolicyDisabled;
      }
      document.getElementById('smsNotification').disabled = !document.getElementById('editSmsNotification').checked;
      document.getElementById('emailNotification').disabled = !document.getElementById('editEmailNotification').checked;
      document.getElementById('flash').disabled = !document.getElementById('editFlash').checked;

      document.getElementById('deliveryType').disabled=!document.getElementById('editDeliveryType').checked;
      e = document.getElementById('transactionMode');
      if(e != null) {
        e.disabled=!document.getElementById('editTransactionMode').checked;
      }
      e = document.getElementById('validityPeriod.hours');
      if(e != null) {
        e.disabled=!document.getElementById('editValidHours').checked;
        document.getElementById('validityPeriod.minutes').disabled=!document.getElementById('editValidHours').checked;
      }
      e = document.getElementById('transactionMode');
      if(e != null) {
        var d = e.checked ? 'none' : '';
        document.getElementById('editValidHours').style.display=d;
        document.getElementById('validHoursLabel').style.display=d;
        document.getElementById('validityPeriod').style.display=d;
      }
      var dt = document.getElementById('deliveryType');
      var disp = dt.options[0].selected ? '' : 'none';
      displaySmsSettings(disp);
    </script>

  </h:panelGroup>


</tr:form>

</ui:define>

</ui:composition>


</html>