<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:tr="http://myfaces.apache.org/trinidad"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:eye="http://taglib.eyeline.mobi">

<ui:composition template="/templates/main.xhtml">

  <ui:param name="pageTitle" value="#{ userEdit.userId!=null ? msg['user.edit.title'] : msg['user.add.title']}"/>

  <ui:define name="content">

    <tr:form id="userForm" rendered="#{!userEdit.initError}">

      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{userEdit.save}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="USERS" immediate="true"/>
        </eye:button>
        <eye:space/>
      </eye:buttons>

      <tr:inputHidden id="userId" value="#{userEdit.userId}"/>
      <eye:delimiter/>

      <h:panelGrid style="padding-left:10px;" columns="2" columnClasses="column100Width, columnTopLeftAlign">

        <h:outputText style="white-space:nowrap;" value="#{userBundle.login}"/>
        <tr:outputText value="#{userEdit.userToEdit.login}" rendered="#{userEdit.userId!=null}"/>
        <tr:inputText value="#{userEdit.userToEdit.login}" rendered="#{userEdit.userId==null}" simple="true">
          <tr:validateLength minimum="1"/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.password']}"/>
        <tr:inputText secret="true" value="#{userEdit.userToEdit.password}" simple="true">
          <tr:validateLength minimum="3" maximum="15"/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.passwordConfirm']}"/>
        <tr:inputText secret="true" value="#{userEdit.passwordConfirm}"  simple="true">
          <tr:validateLength minimum="3" maximum="15"/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.firstName}"/>
        <tr:inputText value="#{userEdit.userToEdit.firstName}" simple="true" required="true"/>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.lastName}"/>
        <tr:inputText value="#{userEdit.userToEdit.lastName}" simple="true" required="true"/>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.organization}"/>
        <tr:inputText value="#{userEdit.userToEdit.organization}" simple="true" required="true"/>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.phone}"/>
        <tr:inputText value="#{userEdit.userToEdit.phone}" simple="true" required="true">
          <eye:validatePhone/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.email}"/>
        <tr:inputText value="#{userEdit.userToEdit.email}" simple="true" required="true">
          <eye:validateEmail/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.isAdmin']}"/>
        <h:selectBooleanCheckbox value="#{userEdit.admin}" style="position: relative;  left: -3px;"/>

        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.blocked']}"/>
        <h:selectBooleanCheckbox value="#{userEdit.blocked}" style="position: relative;  left: -3px;"/>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.locale}"/>
        <h:selectOneMenu value="#{userEdit.userLocale}" style="align:left;" required="true" >
          <f:selectItems value="#{userEdit.locales}"/>
        </h:selectOneMenu>

      </h:panelGrid>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.defaults']}" opened="true">

        <h:panelGrid id="default" style="padding-left:10px; padding-top:10px" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.sourceAddr}"/>
          <tr:inputText value="#{userEdit.sourceAddr}" simple="true" required="true" columns="15"/>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.deliveryDays}"/>
          <h:selectManyCheckbox value="#{userEdit.activeWeekDays}" style="width: 100px">
            <f:selectItems value="#{userEdit.daysItems}"/>
          </h:selectManyCheckbox>

          <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.active.period']}"/>
          <h:panelGroup>
            <eye:inputDate value="#{userEdit.deliveryStartTime}" required="true" type="short_time"/>
            <h:outputText style="white-space:nowrap;" value=" - "/>
            <eye:inputDate value="#{userEdit.deliveryEndTime}" required="true" type="short_time"/>
          </h:panelGroup>


          <h:outputText style="white-space:nowrap;" value="#{userBundle.priority}"/>
          <tr:inputText value="#{userEdit.userToEdit.priority}" simple="true" required="true" columns="3">
            <eye:validatePositive/>
          </tr:inputText>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.policyId}"/>
          <h:panelGroup>
            <h:selectOneMenu id="retryOnFail" onchange="retryOnFailChanged()" value="#{userEdit.retryOnFail}">
              <f:selectItem itemValue="off" itemLabel="#{msg['user.edit.retry.off']}"/>
              <f:selectItem itemValue="default" itemLabel="#{msg['user.edit.retry.default']}"/>
              <f:selectItem itemValue="custom" itemLabel="#{msg['user.edit.retry.custom']}"/>
            </h:selectOneMenu>
            <h:outputText style="white-space:nowrap;" value=" "/>
            <h:inputText id="retryPolicy" value="#{userEdit.userToEdit.policyId}"/>
          </h:panelGroup>



          <h:outputText id="validHoursLabel" style="white-space:nowrap;" value="#{userBundle.validityPeriod}"/>
          <eye:inputDate id="validityPeriod" value="#{userEdit.validityPeriod}" required="true"  type="short_time"/>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.smsNotification}"/>
          <h:selectBooleanCheckbox value="#{userEdit.userToEdit.smsNotification}" style="position: relative;  left: -3px;"/>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.emailNotification}"/>
          <h:selectBooleanCheckbox value="#{userEdit.userToEdit.emailNotification}" style="position: relative; left: -3px;"/>

          <h:outputText style="white-space:nowrap;display: #{userEdit.allowUssdPushDeliveries ? '' : 'none'}" value="#{userBundle.deliveryType}"/>
          <h:selectOneMenu id="deliveryType" value="#{userEdit.userToEdit.deliveryType}" style="align:left; display: #{userEdit.allowUssdPushDeliveries ? '' : 'none'}" required="true"
                           onchange="deliveryTypeChanged()">
            <f:selectItems value="#{userEdit.deliveryTypes}"/>
          </h:selectOneMenu>

          <h:outputText id="trModeLabel" style="white-space:nowrap;" value="#{userBundle.transactionMode}"/>
          <h:selectBooleanCheckbox id="trMode" value="#{userEdit.userToEdit.transactionMode}" style="position: relative; left: -3px;"/>

        </h:panelGrid>        

      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.restrictions']}" opened="true">
        <h:panelGrid style="padding-top:10px; padding-left:10px" columns="2" columnClasses="column100Width,columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.smsPerSec}"/>
          <tr:inputText value="#{userEdit.userToEdit.smsPerSec}" simple="true" columns="5">
            <eye:validatePositive/>
          </tr:inputText>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.regions}"/>
          <h:panelGroup>
            <h:selectBooleanCheckbox id="allRegions" value="#{userEdit.userToEdit.allRegionsAllowed}" style="position: relative; top: 1px; left: -3px;" onchange="allRegionsChanged()"/>
            <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.all']}"/>
          </h:panelGroup>

          <h:outputText id="regionsSelectManyLabel" style="white-space:nowrap;" value="&#160;"/>
          <tr:selectManyCheckbox id="regionsSelectMany" value="#{userEdit.userToEdit.regions}" simple="true" inlineStyle="position: relative; top: 1px; left: -3px;">
            <f:selectItems value="#{userEdit.regionsList}"/>
          </tr:selectManyCheckbox>
        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.import']}" opened="true">

        <h:panelGrid style="padding-left:10px; padding-top:10px" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.enable.import']}"/>
          <h:selectBooleanCheckbox value="#{userEdit.userToEdit.importDeliveriesFromDir}"
            id="importDeliveriesFromDir"
            onchange="document.getElementById('importDeliveriesSettings').style.display=this.checked ? '' : 'none';"
              />
        </h:panelGrid>

        <h:panelGrid id="importDeliveriesSettings" style="padding-left:10px; display: #{userEdit.userToEdit.importDeliveriesFromDir ? '':'none'};" columns="1" columnClasses="columnTopLeftAlign">
          <p/>
          <h:outputText style="white-space:nowrap;  font-weight:bold;" value="#{msg['user.edit.import.sftpsources']}"/>
          <eye:dynamicTable value="#{userEdit.dynamicSfptModel}">
            <eye:textColumn width="25%" title="#{msg['user.edit.import.host']}"   name="host" maxLength="50" allowEditAfterAdd="true"/>
            <eye:textColumn width="5%"  title="#{msg['user.edit.import.port']}"   name="port" maxLength="8" allowEditAfterAdd="true"/>
            <eye:textColumn width="10%" title="#{msg['user.edit.import.login']}"   name="login" maxLength="20" allowEditAfterAdd="true"/>
            <eye:textColumn width="10%" title="#{msg['user.edit.import.password']}"   name="password" maxLength="20" allowEditAfterAdd="true"/>
            <eye:textColumn width="35%" title="#{msg['user.edit.import.directory']}"   name="directory" maxLength="1024" allowEditAfterAdd="true"/>
            <eye:selectColumn width="5%" title="#{msg['user.edit.import.encoding']}" name="encoding" allowEditAfterAdd="true" values="#{userEdit.fileEncodings}"/>
            <eye:textColumn width="10%" title="#{msg['user.edit.import.sourceAddress']}"   name="sourceAddress" maxLength="15" allowEditAfterAdd="true"/>
          </eye:dynamicTable>
          <p/>
          <h:outputText style="white-space:nowrap; font-weight:bold;" value="#{msg['user.edit.import.filesources']}" />
          <eye:dynamicTable value="#{userEdit.dynamicFileModel}">
            <eye:textColumn width="85%" title="#{msg['user.edit.import.directory']}"   name="directory" maxLength="1024" allowEditAfterAdd="true"/>
            <eye:selectColumn width="5%" title="#{msg['user.edit.import.encoding']}"   name="encoding" allowEditAfterAdd="true" values="#{userEdit.fileEncodings}"/>
            <eye:textColumn width="10%" title="#{msg['user.edit.import.sourceAddress']}"  name="sourceAddress" maxLength="15" allowEditAfterAdd="true"/>
          </eye:dynamicTable>
          <p/>
          <eye:buttons>
            <eye:space/>
            <eye:button>
              <tr:commandLink text="#{msg['testconnect.button']}" action="#{userEdit.verifyUcps}"/>
            </eye:button>
          </eye:buttons>
          <p/>
          <h:panelGrid columns="2" columnClasses="column100WidthNoWrap, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.createReports}"/>
          <h:selectBooleanCheckbox id="createReports" value="#{userEdit.userToEdit.createReports}"/>
          </h:panelGrid>
        </h:panelGrid>

      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.archive']}" opened="true">

        <h:panelGrid style="padding-left:10px; padding-top:10px" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.createArchive}"/>
          <h:selectBooleanCheckbox value="#{userEdit.userToEdit.createArchive}" onchange="document.getElementById('archiveSettings').style.display=this.checked ? '' : 'none'"/>
        </h:panelGrid>

        <h:panelGrid id="archiveSettings" style="padding-left:10px;display: #{userEdit.userToEdit.createArchive ? '':'none'};" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.delivery.lifetime']}"/>
          <tr:inputText value="#{userEdit.userToEdit.deliveryLifetime}" simple="true" required="true" columns="5">
            <eye:validatePositive/>
          </tr:inputText>
        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.billing']}" opened="true">
        <h:panelGrid style="padding-left:10px; padding-top:10px" columns="2" columnClasses="column100Width, columnTopLeftAlign">

          <h:outputText style="white-space:nowrap;" value="#{userBundle.createCDR}"/>
          <tr:selectBooleanCheckbox id="createCDR" value="#{userEdit.userToEdit.createCDR}" simple="true" onchange="
            document.getElementById('cdrOpts').style.display = this.checked ? '' : 'none';
          "/>

        </h:panelGrid>

        <h:panelGrid id="cdrOpts" style="padding-left:10px" columns="2" columnClasses="column100Width, columnTopLeftAlign">

          <h:outputText style="white-space:nowrap;" value="#{userBundle.cdrDestination}"/>
          <tr:inputText value="#{userEdit.userToEdit.cdrDestination}" simple="true"/>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.cdrOriginator}"/>
          <tr:inputText value="#{userEdit.userToEdit.cdrOriginator}" simple="true"/>

        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{userEdit.save}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="USERS" immediate="true"/>
        </eye:button>
        <eye:space/>
      </eye:buttons>

      <script type="text/javascript" language="javascript">
        function retryOnFailChanged() {
          var d = document.getElementById('retryOnFail').options[2].selected ? '' : 'none';
          document.getElementById('retryPolicy').style.display=d;
        }

        function deliveryTypeChanged() {
          var dt = document.getElementById('deliveryType');
          var disp = dt.options[0].selected ? '' : 'none';
          document.getElementById('trMode').style.display=disp;
          document.getElementById('trModeLabel').style.display=disp;
        }

        function allRegionsChanged() {
          var d= document.getElementById("allRegions").checked ? 'none':'';
          document.getElementById('regionsSelectMany').style.display = d;
          document.getElementById('regionsSelectManyLabel').style.display = d;
        }

        retryOnFailChanged();

        deliveryTypeChanged();

        allRegionsChanged();
        
        d = document.getElementById('importDeliveriesFromDir').checked ? '':'none';
        document.getElementById('importDeliveriesSettings').style.display=d;

        var cdr = document.getElementById('createCDR').checked;
        document.getElementById('cdrOpts').style.display = cdr ? '' : 'none';

      </script>

    </tr:form>

  </ui:define>

</ui:composition>


</html>