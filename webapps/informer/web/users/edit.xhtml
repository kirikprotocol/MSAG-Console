<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:tr="http://myfaces.apache.org/trinidad"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:eye="http://taglib.eyeline.mobi">

<ui:composition template="/templates/main.xhtml">

  <ui:param name="pageTitle" value="#{ userEdit.userId!=null ? msg['user.edit.title'] : msg['user.add.title']}"/>

  <ui:define name="content">

    <tr:form id="userForm" rendered="#{!userEdit.initError}">
    
      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{userEdit.save}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="USERS" immediate="true"/>
        </eye:button>
        <eye:space/>
      </eye:buttons>

      <tr:inputHidden id="userId" value="#{userEdit.userId}"/>
      <eye:delimiter/>
      
      <h:panelGrid style="padding-left:10px;" columns="2" columnClasses="column100Width, columnTopLeftAlign">

        <h:outputText style="white-space:nowrap;" value="#{userBundle.login}"/>
        <tr:outputText value="#{userEdit.userToEdit.login}" rendered="#{userEdit.userId!=null}"/>
        <tr:inputText value="#{userEdit.userToEdit.login}" rendered="#{userEdit.userId==null}" simple="true">
          <tr:validateLength minimum="1"/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.password']}"/>
        <tr:inputText secret="true" value="#{userEdit.userToEdit.password}" simple="true">
          <tr:validateLength minimum="3" maximum="15"/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.passwordConfirm']}"/>
        <tr:inputText secret="true" value="#{userEdit.passwordConfirm}"  simple="true">
          <tr:validateLength minimum="3" maximum="15"/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.firstName}"/>
        <tr:inputText value="#{userEdit.userToEdit.firstName}" simple="true" required="true"/>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.lastName}"/>
        <tr:inputText value="#{userEdit.userToEdit.lastName}" simple="true" required="true"/>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.organization}"/>
        <tr:inputText value="#{userEdit.userToEdit.organization}" simple="true" required="true"/>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.phone}"/>
        <tr:inputText value="#{userEdit.userToEdit.phone}" simple="true" required="true">
          <eye:validatePhone/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.email}"/>
        <tr:inputText value="#{userEdit.userToEdit.email}" simple="true" required="true">
          <eye:validateEmail/>
        </tr:inputText>

        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.isAdmin']}"/>
        <h:selectBooleanCheckbox value="#{userEdit.admin}"/>

        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.blocked']}"/>
        <h:selectBooleanCheckbox value="#{userEdit.blocked}"/>

        <h:outputText style="white-space:nowrap;" value="#{userBundle.locale}"/>
        <h:selectOneMenu value="#{userEdit.userLocale}" style="align:left;" required="true" >
          <f:selectItems value="#{userEdit.locales}"/>
        </h:selectOneMenu>

      </h:panelGrid>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.defaults']}" opened="true">

        <h:panelGrid id="default" style="padding-left:10px; padding-top:10px" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.sourceAddr}"/>
          <tr:inputText value="#{userEdit.sourceAddr}" simple="true" required="true" columns="15"/>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.deliveryDays}"/>
          <h:selectManyCheckbox value="#{userEdit.activeWeekDays}" style="width: 100px">
            <f:selectItems value="#{userEdit.daysItems}"/>
          </h:selectManyCheckbox>

          <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.active.period']}"/>
          <h:panelGroup>
            <t:inputDate value="#{userEdit.deliveryStartTime}" requiredMessage="#{msg['date.required']}" required="true" type="short_time"/>
            <h:outputText style="white-space:nowrap;" value=" - "/>
            <t:inputDate value="#{userEdit.deliveryEndTime}" requiredMessage="#{msg['date.required']}" required="true" type="short_time"/>
          </h:panelGroup>


          <h:outputText style="white-space:nowrap;" value="#{userBundle.priority}"/>
          <tr:inputText value="#{userEdit.userToEdit.priority}" simple="true" required="true" columns="3">
            <eye:validatePositive/>
          </tr:inputText>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.policyId}"/>
          <h:panelGroup>
            <h:selectBooleanCheckbox id="retryOnFail" value="#{userEdit.userToEdit.retryOnFail}" style="position: relative; top: 2px; left: -3px;" onchange="document.getElementById('retryPolicy').disabled=!this.checked;"/>
            <h:inputText id="retryPolicy" value="#{userEdit.userToEdit.policyId}"/>
          </h:panelGroup>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.smsNotification}"/>
          <tr:selectBooleanCheckbox value="#{userEdit.userToEdit.smsNotification}" simple="true"/>
          
          <h:outputText style="white-space:nowrap;" value="#{userBundle.emailNotification}"/>                              
          <tr:selectBooleanCheckbox value="#{userEdit.userToEdit.emailNotification}" simple="true"/>

          <h:outputText style="white-space:nowrap;display: #{userEdit.allowUssdPushDeliveries ? '' : 'none'}" value="#{userBundle.deliveryType}"/>
          <h:selectOneMenu id="deliveryType" value="#{userEdit.userToEdit.deliveryType}" style="align:left; display: #{userEdit.allowUssdPushDeliveries ? '' : 'none'}" required="true" onchange="
          var dt = document.getElementById('deliveryType');
          var disp = dt.options[0].selected ? '' : 'none';
          document.getElementById('smsSettings').style.display=disp;
          " >
            <f:selectItems value="#{userEdit.deliveryTypes}"/>
          </h:selectOneMenu>

        </h:panelGrid>

        <h:panelGrid id="smsSettings" style="padding-left:10px; display: #{userEdit.smsDeliveryMode == true ? '' : 'none'}" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.transactionMode}"/>
          <tr:selectBooleanCheckbox id="trMode" value="#{userEdit.userToEdit.transactionMode}" simple="true"
                                    onchange="
                                    var d = this.checked ? 'none' : '';
                                    document.getElementById('validHoursLabel').style.display=d;
                                    document.getElementById('validityPeriod').style.display=d;
                                    "/>

          <h:outputText id="validHoursLabel" style="white-space:nowrap;" value="#{userBundle.validityPeriod}"/>
          <t:inputDate id="validityPeriod" value="#{userEdit.validityPeriod}" requiredMessage="#{msg['date.required']}" required="true"  type="short_time"/>
        </h:panelGrid>

      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.restrictions']}" opened="true">
        <h:panelGrid style="padding-top:10px; padding-left:10px" columns="2" columnClasses="column100Width,columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.smsPerSec}"/>
          <tr:inputText value="#{userEdit.userToEdit.smsPerSec}" simple="true" columns="5">
            <eye:validatePositive/>
          </tr:inputText>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.regions}"/>
          <tr:selectBooleanCheckbox value="#{userEdit.userToEdit.allRegionsAllowed}" text="#{msg['user.edit.all']}" simple="true" required="false" onchange="var el = document.getElementById('regionsSelectMany'); el.style.display = this.checked ? 'none':'';"/>

          <h:outputText style="white-space:nowrap;" value="&#160;"/>
          <tr:selectManyCheckbox id="regionsSelectMany" value="#{userEdit.userToEdit.regions}" simple="true" contentStyle="display: #{userEdit.userToEdit.allRegionsAllowed==true ? 'none':''};">
            <f:selectItems value="#{userEdit.regionsList}"/>
          </tr:selectManyCheckbox>
        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.import']}" opened="true">

        <h:panelGrid style="padding-left:10px; padding-top:10px" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.enable.import']}"/>
          <h:selectBooleanCheckbox value="#{userEdit.userToEdit.importDeliveriesFromDir}"
                                   id="importDeliveriesFromDir"
            onchange="
            document.getElementById('importDeliveriesSettings').style.display=this.checked ? '' : 'none';
            var createReports = document.getElementById('createReports').checked &amp;&amp; this.checked;
            document.getElementById('reportsExportSettings').style.display=createReports ? '' : 'none';
          "/>
        </h:panelGrid>

        <h:panelGrid id="importDeliveriesSettings" style="padding-left:10px; display: #{userEdit.userToEdit.importDeliveriesFromDir ? '':'none'};" columns="2" columnClasses="column100WidthNoWrap, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.directory}"/>
          <tr:inputText value="#{userEdit.userToEdit.directory}" simple="true" columns="100"/>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.fileEncoding}"/>
          <h:selectOneMenu value="#{userEdit.userToEdit.fileEncoding}" style="align:left;" required="true" >
          <f:selectItems value="#{userEdit.fileEncodings}"/>
          </h:selectOneMenu>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.createReports}"/>
          <h:selectBooleanCheckbox id="createReports" value="#{userEdit.userToEdit.createReports}" onchange="document.getElementById('reportsExportSettings').style.display=this.checked ? '' : 'none';"/>
        </h:panelGrid>

        <h:panelGrid id="reportsExportSettings" style="padding-left:10px; display: #{(userEdit.userToEdit.importDeliveriesFromDir and userEdit.userToEdit.createReports) ? '':'none'};" columns="2" columnClasses="column100WidthNoWrap, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.reportsLifetime}"/>
          <tr:inputText id="reportsLifeTime" value="#{userEdit.userToEdit.reportsLifetime}" simple="true" required="true" columns="5">
            <eye:validatePositive/>
          </tr:inputText>
        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.archive']}" opened="true">

        <h:panelGrid style="padding-left:10px; padding-top:10px" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.createArchive}"/>
          <h:selectBooleanCheckbox value="#{userEdit.userToEdit.createArchive}" onchange="document.getElementById('archiveSettings').style.display=this.checked ? '' : 'none'"/>
        </h:panelGrid>

        <h:panelGrid id="archiveSettings" style="padding-left:10px;display: #{userEdit.userToEdit.createArchive ? '':'none'};" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.delivery.lifetime']}"/>
          <tr:inputText value="#{userEdit.userToEdit.deliveryLifetime}" simple="true" required="true" columns="5">
            <eye:validatePositive/>
          </tr:inputText>
        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.billing']}" opened="true">
        <h:panelGrid style="padding-left:10px; padding-top:10px" columns="2" columnClasses="column100Width, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="#{userBundle.createCDR}"/>
          <tr:selectBooleanCheckbox value="#{userEdit.userToEdit.createCDR}" simple="true"/>
        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>
      
      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{userEdit.save}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="USERS" immediate="true"/>
        </eye:button>
        <eye:space/>
      </eye:buttons>

      <script type="text/javascript" language="javascript">
        document.getElementById('retryPolicy').disabled = !document.getElementById('retryOnFail').checked;
        var d = document.getElementById('trMode').checked ? 'none' : '';
        document.getElementById('validHoursLabel').style.display=d;
        document.getElementById('validityPeriod').style.display=d;

        d = document.getElementById('importDeliveriesFromDir').checked ? '':'none';
        document.getElementById('importDeliveriesSettings').style.display=d;
      </script>

    </tr:form>

  </ui:define>

</ui:composition>


</html>