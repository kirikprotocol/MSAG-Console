<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:tr="http://myfaces.apache.org/trinidad"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:eye="http://taglib.eyeline.mobi">

<ui:composition template="/templates/main.xhtml">

  <ui:param name="pageTitle" value="#{msg['user.groupEdit.title']}"/>

  <ui:define name="content">

    <tr:form>

      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{userGroupEdit.save}" shortDesc="#{msg['users.details.save']}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="USERS" immediate="true" shortDesc="#{msg['user.details.cancel']}"/>
        </eye:button>
        <eye:space/>
      </eye:buttons>


      <h:panelGrid style="padding:10px" columns="3" columnClasses="column20Width, column100Width, columnTopLeftAlign">

        <h:selectBooleanCheckbox id="editOrganization" value="#{userGroupEdit.editOrganization}" onchange="document.getElementById('organization').disabled=!this.checked"/>
        <h:outputText style="white-space:nowrap;" value="#{userBundle.organization}"/>
        <tr:inputText simple="true" id="organization" value="#{userGroupEdit.organization}"  />

        <h:selectBooleanCheckbox id="editAdmin" value="#{userGroupEdit.editAdmin}" onchange="document.getElementById('admin').disabled=!this.checked"/>
        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.isAdmin']}"/>
        <h:selectBooleanCheckbox id="admin" value="#{userGroupEdit.admin}"/>

        <h:selectBooleanCheckbox id="editBlocked" value="#{userGroupEdit.editBlocked}" onchange="document.getElementById('blocked').disabled=!this.checked"/>
        <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.blocked']}"/>
        <h:selectBooleanCheckbox id="blocked" value="#{userGroupEdit.blocked}"/>

      </h:panelGrid>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.defaults']}" opened="true">
        <h:panelGrid id="default" style="padding-left:10px; padding-top:10px" columns="3" columnClasses="column20Width,column100WidthNoWrap, columnTopLeftAlign">

          <h:selectBooleanCheckbox id="editSourceAddr" value="#{userGroupEdit.editSourceAddr}" onchange="document.getElementById('sourceAddr').disabled=!this.checked"/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.sourceAddr}"/>
          <h:inputText id="sourceAddr" value="#{userGroupEdit.sourceAddr}" converter="addressConverter"  size="15" converterMessage="#{userBundle.sourceAddr}" />

          <h:selectBooleanCheckbox id="editDeliveryDays" value="#{userGroupEdit.editDeliveryDays}" onchange="
          for (var i = 0; i&lt;7; i++)
            document.getElementById('deliveryDays:' + i).disabled=!this.checked
          "/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.deliveryDays}"/>
          <h:selectManyCheckbox id="deliveryDays" value="#{userGroupEdit.deliveryDays}" style="width: 100px" >
            <f:selectItems value="#{userGroupEdit.daysItems}"/>
          </h:selectManyCheckbox>

          <h:selectBooleanCheckbox id="editDeliveryStartTime" value="#{userGroupEdit.editDeliveryStartTime}" onchange="
          document.getElementById('deliveryStartTime.hours').disabled=!this.checked;
          document.getElementById('deliveryStartTime.minutes').disabled=!this.checked"
              />
          <h:outputText style="white-space:nowrap;" value="#{userBundle.deliveryStartTime}"/>
          <eye:inputDate id="deliveryStartTime" value="#{userGroupEdit.deliveryStartTime}" type="short_time"/>

          <h:selectBooleanCheckbox id="editDeliveryEndTime" value="#{userGroupEdit.editDeliveryEndTime}" onchange="
          document.getElementById('deliveryEndTime.hours').disabled=!this.checked;
          document.getElementById('deliveryEndTime.minutes').disabled=!this.checked;
          "/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.deliveryEndTime}"/>
          <eye:inputDate id="deliveryEndTime" value="#{userGroupEdit.deliveryEndTime}" type="short_time"/>

          <h:selectBooleanCheckbox id="editPriority" value="#{userGroupEdit.editPriority}" onchange="document.getElementById('priority').disabled=!this.checked"/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.priority}"/>
          <tr:inputText simple="true" id="priority" value="#{userGroupEdit.priority}"   columns="3"/>

          <h:selectBooleanCheckbox id="editRetryPolicy" value="#{userGroupEdit.editRetryPolicy}" onchange="
          document.getElementById('retryPolicy').disabled=!this.checked;
          document.getElementById('retryOnFail').disabled=!this.checked;
          "/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.policyId}"/>
          <h:panelGroup>
            <h:selectOneMenu id="retryOnFail" onchange="retryOnFailChanged()" value="#{userGroupEdit.retryOnFail}">
              <f:selectItem itemValue="off" itemLabel="#{msg['user.edit.retry.off']}"/>
              <f:selectItem itemValue="default" itemLabel="#{msg['user.edit.retry.default']}"/>
              <f:selectItem itemValue="custom" itemLabel="#{msg['user.edit.retry.custom']}"/>
            </h:selectOneMenu>
            <h:outputText value=" "/>
            <h:inputText id="retryPolicy" value="#{userGroupEdit.policyId}" />
          </h:panelGroup>

          <h:selectBooleanCheckbox id="editMessageTimeToLive" value="#{userGroupEdit.editMessageTimeToLive}" onchange="
          document.getElementById('messageTimeToLive.hours').disabled=!this.checked;
          document.getElementById('messageTimeToLive.minutes').disabled=!this.checked;
          "/>
          <h:outputText id="messageTimeToLiveLabel" style="white-space:nowrap;" value="#{userBundle.messageTimeToLive}"/>
          <eye:inputTime id="messageTimeToLive" value="#{userGroupEdit.messageTimeToLive}"/>

          <h:selectBooleanCheckbox id="editValidHours" value="#{userGroupEdit.editValidityPeriod}" onchange="
          document.getElementById('validityPeriod.hours').disabled=!this.checked;
          document.getElementById('validityPeriod.minutes').disabled=!this.checked;
          "/>
          <h:outputText id="validHoursLabel" style="white-space:nowrap;" value="#{userBundle.validityPeriod}"/>
          <eye:inputTime id="validityPeriod" value="#{userGroupEdit.validityPeriod}"/>

          <h:selectBooleanCheckbox id="editSmsNotification" value="#{userGroupEdit.editSmsNotification}" onchange="document.getElementById('smsNotification').disabled=!this.checked"/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.smsNotification}"/>
          <tr:selectBooleanCheckbox simple="true" id="smsNotification" value="#{userGroupEdit.smsNotification}" />

          <h:selectBooleanCheckbox id="editEmailNotification" value="#{userGroupEdit.editEmailNotification}" onchange="document.getElementById('emailNotification').disabled=!this.checked"/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.emailNotification}"/>
          <tr:selectBooleanCheckbox simple="true" id="emailNotification" value="#{userGroupEdit.emailNotification}"  />

          <h:selectBooleanCheckbox id="editUseDataSm" value="#{userGroupEdit.editUseDataSm}" onchange="document.getElementById('useDataSm').disabled=!this.checked" style="display:#{userGroupEdit.allowUssdPushDeliveries ? '' : 'none'}"/>
          <h:outputText style="white-space:nowrap;display: #{userGroupEdit.allowUssdPushDeliveries ? '' : 'none'}" value="#{userBundle.useDataSm}" />
          <h:selectBooleanCheckbox id="useDataSm" style="white-space:nowrap;display: #{userGroupEdit.allowUssdPushDeliveries ? '' : 'none'}" value="#{userGroupEdit.useDataSm}" />

          <h:selectBooleanCheckbox id="editDeliveryType" value="#{userGroupEdit.editDeliveryType}" onchange="document.getElementById('deliveryType').disabled=!this.checked" style="display:#{userGroupEdit.allowUssdPushDeliveries ? '' : 'none'}"/>
          <h:outputText style="white-space:nowrap;display: #{userGroupEdit.allowUssdPushDeliveries ? '' : 'none'}" value="#{userBundle.deliveryType}" />
          <h:selectOneMenu id="deliveryType" value="#{userGroupEdit.deliveryType}" style="align:left;display: #{userGroupEdit.allowUssdPushDeliveries ? '' : 'none'}"
                           onchange="deliveryTypeChanged()">
            <f:selectItems value="#{userGroupEdit.deliveryTypes}"/>
          </h:selectOneMenu>

          <h:selectBooleanCheckbox id="editTransactionMode" value="#{userGroupEdit.editTransactionMode}" onchange="document.getElementById('transactionMode').disabled=!this.checked"/>
          <h:outputText id="transactionModeLabel" style="white-space:nowrap;" value="#{userBundle.transactionMode}"/>
          <h:selectBooleanCheckbox id="transactionMode" value="#{userGroupEdit.transactionMode}"/>

        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.restrictions']}" opened="true">
        <h:panelGrid id="default" style="padding-left:10px; padding-top:10px" columns="3" columnClasses="column20Width,column100Width, columnTopLeftAlign">
          <h:selectBooleanCheckbox id="editSmsPerSec" value="#{userGroupEdit.editSmsPerSec}" onchange="document.getElementById('smsPerSec').disabled=!this.checked"/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.smsPerSec}"/>
          <tr:inputText simple="true" id="smsPerSec" value="#{userGroupEdit.smsPerSec}"  columns="5"/>

          <h:selectBooleanCheckbox id="editAllowedRegions" value="#{userGroupEdit.editAllowedRegions}" onchange="
          document.getElementById('allRegions').disabled=!this.checked;
          var i = 0;
          while(true) {
            var el=document.getElementById('regionsSelectMany:_' + i);
            if (el != null &amp;&amp; el != 'undefined') {
              el.disabled=!this.checked;
            } else
              break;
            i++;
          }
          "/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.regions}"/>
          <tr:selectBooleanCheckbox simple="true" id="allRegions" value="#{userGroupEdit.allRegionsAllowed}" text="#{msg['user.edit.all']}"  onchange="var el = document.getElementById('regionsSelectMany'); el.style.display = this.checked ? 'none':'';"/>

          <h:outputText style="white-space:nowrap;" value="&#160;"/>
          <h:outputText style="white-space:nowrap;" value="&#160;"/>
          <tr:selectManyCheckbox simple="true" id="regionsSelectMany" value="#{userGroupEdit.regions}"  contentStyle="display: #{userGroupEdit.allRegionsAllowed==true ? 'none':''};">
            <f:selectItems value="#{userGroupEdit.regionsList}"/>
          </tr:selectManyCheckbox>

        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.archive']}" opened="true">

        <h:panelGrid style="padding-left:10px; padding-top:10px" columns="3" columnClasses="column20Width, column100WidthNoWrap, columnTopLeftAlign">
          <h:selectBooleanCheckbox id="editArchivateDeliveries" value="#{userGroupEdit.editArchivateDeliveries}" onchange="
          document.getElementById('createArchive').disabled=!this.checked;
          document.getElementById('deliveryLifetime').disabled=!this.checked;
          "/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.createArchive}"/>
          <h:selectBooleanCheckbox id="createArchive" value="#{userGroupEdit.createArchive}" onchange="document.getElementById('archiveSettings').style.display=this.checked ? '' : 'none'"/>
        </h:panelGrid>

        <h:panelGrid id="archiveSettings" style="padding-left:10px;display: #{userGroupEdit.createArchive ? '':'none'};" columns="3" columnClasses="column20Width,column100WidthNoWrap, columnTopLeftAlign">
          <h:outputText style="white-space:nowrap;" value="&#160;"/>
          <h:outputText style="white-space:nowrap;" value="#{msg['user.edit.delivery.lifetime']}"/>
          <tr:inputText simple="true" id="deliveryLifetime" value="#{userGroupEdit.deliveryLifetime}"  columns="5"/>
        </h:panelGrid>
      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:collapsingGroup label="#{msg['user.edit.billing']}" opened="true">
        <h:panelGrid style="padding-left:10px; padding-top:10px" columns="3" columnClasses="column20Width, column100WidthNoWrap, columnTopLeftAlign">
          <h:selectBooleanCheckbox id="editCreateCdr" value="#{userGroupEdit.editCreateCdr}" onchange="
            document.getElementById('createCdr').disabled=!this.checked;
          "/>

          <h:outputText style="white-space:nowrap;" value="#{userBundle.createCDR}"/>
          <h:selectBooleanCheckbox id="createCdr" value="#{userGroupEdit.createCdr}" onchange="
            document.getElementById('cdrOpts').style.display=this.checked ? '' : 'none';
          "/>

        </h:panelGrid>

        <h:panelGrid id="cdrOpts" style="padding-left:10px" columns="3" columnClasses="column20Width, column100WidthNoWrap, columnTopLeftAlign">

          <h:outputText value="&#160;"/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.cdrDestination}"/>
          <tr:inputText simple="true" value="#{userGroupEdit.cdrDestination}" />
          
          <h:outputText value="&#160;"/>
          <h:outputText style="white-space:nowrap;" value="#{userBundle.cdrOriginator}"/>
          <tr:inputText simple="true" value="#{userGroupEdit.cdrOriginator}" />

        </h:panelGrid>

      </eye:collapsingGroup>

      <eye:delimiter/>

      <eye:buttons>
        <eye:button>
          <tr:commandLink text="#{msg['done.button']}" action="#{userGroupEdit.save}" shortDesc="#{msg['users.details.save']}"/>
        </eye:button>
        <eye:button>
          <tr:commandLink text="#{msg['cancel.button']}" action="USERS" immediate="true" shortDesc="#{msg['user.details.cancel']}"/>
        </eye:button>
        <eye:space/>
      </eye:buttons>

      <script type="text/javascript" language="javascript">

        function deliveryTypeChanged() {
          var dt = document.getElementById('deliveryType');
          var disp = dt.options[0].selected ? '' : 'none';
          document.getElementById('editTransactionMode').style.display=disp;
          document.getElementById('transactionModeLabel').style.display=disp;
          document.getElementById('transactionMode').style.display=disp;
        }

        function retryOnFailChanged() {
          var d = document.getElementById('retryOnFail').options[2].selected ? '' : 'none';
          document.getElementById('retryPolicy').style.display=d;
        }

        deliveryTypeChanged();

        retryOnFailChanged();

        document.getElementById('organization').disabled = !document.getElementById('editOrganization').checked;
        document.getElementById('admin').disabled = !document.getElementById('editAdmin').checked;
        document.getElementById('blocked').disabled = !document.getElementById('editBlocked').checked;
        document.getElementById('sourceAddr').disabled = !document.getElementById('editSourceAddr').checked;

        var deliveryDaysDisabled = !document.getElementById('editDeliveryDays').checked;
        for (var i = 0; i&lt;7; i++)
            document.getElementById('deliveryDays:' + i).disabled=deliveryDaysDisabled;

        var deliveryStartTimeDisabled = !document.getElementById('editDeliveryStartTime').checked;
        document.getElementById('deliveryStartTime.hours').disabled=deliveryStartTimeDisabled;
        document.getElementById('deliveryStartTime.minutes').disabled=deliveryStartTimeDisabled;

        var deliveryEndTimeDisabled = !document.getElementById('editDeliveryEndTime').checked;
        document.getElementById('deliveryEndTime.hours').disabled=deliveryEndTimeDisabled;
        document.getElementById('deliveryEndTime.minutes').disabled=deliveryEndTimeDisabled;

        document.getElementById('priority').disabled = !document.getElementById('editPriority').checked;

        var retryPolicyDisabled = !document.getElementById('editRetryPolicy').checked;
        document.getElementById('retryPolicy').disabled=retryPolicyDisabled || !document.getElementById('retryOnFail').checked;
        document.getElementById('retryOnFail').disabled=retryPolicyDisabled;

        document.getElementById('smsNotification').disabled = !document.getElementById('editSmsNotification').checked;
        document.getElementById('emailNotification').disabled = !document.getElementById('editEmailNotification').checked;

        document.getElementById('useDataSm').disabled=!document.getElementById('editUseDataSm').checked;
        document.getElementById('deliveryType').disabled=!document.getElementById('editDeliveryType').checked;
        document.getElementById('transactionMode').disabled=!document.getElementById('editTransactionMode').checked;
        document.getElementById('messageTimeToLive.hours').disabled=!document.getElementById('editMessageTimeToLive').checked;
        document.getElementById('messageTimeToLive.minutes').disabled=!document.getElementById('editMessageTimeToLive').checked;
        document.getElementById('validityPeriod.hours').disabled=!document.getElementById('editValidHours').checked;
        document.getElementById('validityPeriod.minutes').disabled=!document.getElementById('editValidHours').checked;
        document.getElementById('smsPerSec').disabled=!document.getElementById('editSmsPerSec').checked;

        var allowedRegionsDisabled=!document.getElementById('editAllowedRegions').checked;
        document.getElementById('allRegions').disabled=allowedRegionsDisabled;
        var j = 0;
        while(true) {
          var el=document.getElementById('regionsSelectMany:_' + j);
          if (el != null &amp;&amp; el != 'undefined') {
            el.disabled=allowedRegionsDisabled;
          } else
            break;
          j++;
        }

        var archivateDeliveriesDisabled = !document.getElementById('editArchivateDeliveries').checked;
        document.getElementById('createArchive').disabled=archivateDeliveriesDisabled;
        document.getElementById('deliveryLifetime').disabled=archivateDeliveriesDisabled;

        document.getElementById('createCdr').disabled=!document.getElementById('editCreateCdr').checked;
        if(document.getElementById('editCreateCdr').checked &amp;&amp; document.getElementById('createCdr').checked){
          document.getElementById('cdrOpts').style.display='';
        }else {
          document.getElementById('cdrOpts').style.display='none';
        }
        
      </script>

    </tr:form>

  </ui:define>

</ui:composition>


</html>
