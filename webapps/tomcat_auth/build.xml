<project default="update" name="Sibinco Tomcat Authentication Module">

  <property environment="env"/>
  <property name="jmx_jar" location="${env.CATALINA_HOME}/bin/jmx.jar"/>
  <property name="catalina_jar" location="${env.CATALINA_HOME}/server/lib/catalina.jar"/>
  <property name="java_out" location="${env.HOME}/build/classes/tomcat_auth_lib"/>
  <property name="jar_out" location="${env.HOME}/build/jars/"/>

  <target name="init">
    <tstamp/>
    <mkdir dir="${java_out}server/classes"/>
    <mkdir dir="${java_out}common/classes"/>
    <mkdir dir="${java_out}webapp/classes"/>
    <mkdir dir="${jar_out}"/>
  </target>

  <target name="compile" depends="init" description="compile the sources">
    <javac srcdir="common/src" destdir="${java_out}common/classes" classpath="${jmx_jar}:${catalina_jar}"/>
    <javac srcdir="server/src" destdir="${java_out}server/classes" classpath="${jmx_jar}:${catalina_jar}:${java_out}common/classes"/>
    <javac srcdir="webapp/src" destdir="${java_out}webapp/classes" classpath="${jmx_jar}:${catalina_jar}:${java_out}common/classes:${java_out}server/classes"/>
  </target>

  <target name="build" depends="compile" description="generate the distribution">
    <jar jarfile="${jar_out}/sibinco_tomcat_auth_server.jar" basedir="${java_out}server/classes"/>
    <jar jarfile="${jar_out}/sibinco_tomcat_auth_common.jar" basedir="${java_out}common/classes"/>
    <jar jarfile="${jar_out}/sibinco_tomcat_auth.jar"        basedir="${java_out}webapp/classes"/>
  </target>

  <target name="rebuild" depends="clean,build" description="rebuild"/>

  <target name="install" depends="build">
    <copy file="${jar_out}/sibinco_tomcat_auth_server.jar" todir="${env.CATALINA_HOME}/server/lib" preservelastmodified="yes"/>
    <copy file="${jar_out}/sibinco_tomcat_auth_common.jar" todir="${env.CATALINA_HOME}/common/lib" preservelastmodified="yes"/>
  </target>

  <target name="cvs_update">
    <cvs command="update" compressionlevel="9" failonerror="yes"/>
  </target>

  <target name="update" depends="cvs_update,install"/>

  <target name="clean" description="clean up">
    <delete dir="${java_out}server/classes"/>
    <delete dir="${java_out}common/classes"/>
    <delete dir="${java_out}webapp/classes"/>
    <delete file="${jar_out}/sibinco_tomcat_auth_server.jar"/>
    <delete file="${jar_out}/sibinco_tomcat_auth_common.jar"/>
    <delete file="${jar_out}/sibinco_tomcat_auth.jar"/>
  </target>
</project>