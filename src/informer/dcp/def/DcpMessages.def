include Types.def

//
// general responses
//

message OkResponse 1
end

message FailResponse 2
  int32 status 1
  string statusMessage 2
end

//
//users management
//

message UserAuth 11
  string userId 1
  string password 2
end

message GetUserStats 12
  string userId 1 opt
end

message GetUserStatsResp 13
  int16 currentConnectionsCount 1
  int32 currentActiveDeliveriesCount 2
  int32 currentPausedDeliveriesCount 3
  int32 currentPlannedDeliveriesCount 4
  int32 currentFinishedDeliveriesCount 5
  int32 currentCancelledDeliveriesCount 6
end


//
//delivery management
//

enum byte DeliveryMode
  SMS 1
  USSD_PUSH 2
  USSD_PUSH_VLR 3
end

message DeliveryInfo
  property innerMessage=true
  string name 1
  string userId 2 opt
  int32 priority 3
  bool transactionMode 4

// DD.MM.YY hh:mm:ss
  string startDate 5 opt 
// DD.MM.YY hh:mm:ss
  string endDate 6 opt
// hh:mm
  string activePeriodEnd 7
// hh:mm
  string activePeriodStart 8
// mon, tue, sun ...
  string activeWeekDays 9 array
  // removed. has no sense now
//  string validityDate 10 opt
  //hh:mm:ss
  string validityPeriod 11 opt

  bool flash 12
  //bool secret 13
  //bool secretFlash 14
  //bool secretMessage 15
  bool useDataSm 16
  DeliveryMode deliveryMode 17
                                                                                                                                  
  string owner 18

  bool retryOnFail 19
  string retryPolicy 20 opt

  bool replaceMessage 21
  string svcType 22 opt
  
  string userData 23 opt
  
  string sourceAddress 24
  
  bool finalDlvRecords 25
  bool finalMsgRecords 26
  
  //hh:mm:ss
  string archivationPeriod 27 opt
  string messageTimeToLive 28 opt
end

enum byte MessageType
  TextMessage 1
  GlossaryMessage 2
end

message MessageFlags
  property innerMessage=true
  bool transactionMode 1
  bool useDataSm 2
  bool replaceMessage 3
  bool flash 4
  string svcType 5 opt
  string sourceAddress 6 opt
  DeliveryMode deliveryMode 7 opt
end

message DeliveryMessage
  property innerMessage=true
  string abonent 1
  MessageType msgType 2 
  string text 3 opt
  int32 index 4 opt
  string userData 5 opt
  MessageFlags flags 6 opt
end


message CreateDelivery 30
  DeliveryInfo info 1
end

message CreateDeliveryResp 31
  int32 deliveryId 1
end

message ModifyDelivery 32
  int32 deliveryId 1
  DeliveryInfo info 2
end

message GetDeliveryInfo 48
  int32 deliveryId 1
end

message GetDeliveryInfoResp 49
  DeliveryInfo info 1
end

enum byte DeliveryStatus
  Planned 1
  Active 2
  Paused 3
  Cancelled 4
  Finished 5
end

enum byte DeliveryFields
  UserId 1
  Name 2
  Status 3
  StartDate 4
  EndDate 5
  ActivityPeriod 6
  UserData 7
end

message DeliveriesFilter
  property innerMessage=true
  string userIdFilter 1 array opt
  string nameFilter 2 array opt
  DeliveryStatus statusFilter 3 array opt
  string startDateFrom 4 opt
  string startDateTo 5 opt
  string endDateFrom 6 opt
  string endDateTo 7 opt
end

message GetDeliveriesList 50
  DeliveriesFilter filter 1
  DeliveryFields resultFields 2 array
end

message GetDeliveriesListResp 51
  int32 reqId 1
end

message GetDeliveriesListNext 52
  int32 reqId 1
  int32 count 2
  int32 timeout 3
end

message DeliveryListInfo
  property innerMessage=true
  int32 deliveryId 1
  string userId 2 opt
  string name 3 opt
  DeliveryStatus status 4 opt
  string startDate 5 opt
  string endDate 6 opt
  string activityPeriodStart 7 opt
  string activityPeriodEnd 8 opt
  string userData 9 opt
end

message GetDeliveriesListNextResp 53
  bool moreDeliveries 1
  DeliveryListInfo info 2 array
end

message CountDeliveries 54
  DeliveriesFilter filter 1
end

// NOTE: reqId is 2 to be incompatible with previous protocol version
message CountDeliveriesResp 55
  int32 reqId 2
end

message CountDeliveriesNext 60
  int32 reqId 1
  int32 count 2
  int32 timeout 3
end

message CountDeliveriesNextResp 61
  bool moreDeliveries 1
  int32 count 2
end

message DropDelivery 33
  int32 deliveryId 1
  bool moveToArchive 2 opt
end


message DeliveryState
  property innerMessage=true
  DeliveryStatus status 1
  string date 2 opt
end

message ChangeDeliveryState 34
  int32 deliveryId 1
  DeliveryState state 2
end

message AddDeliveryMessages 35
  int32 deliveryId 1
  DeliveryMessage messages 2 array
end

message AddDeliveryMessagesResp 36
  int64 messageIds 1 array
end

message DropDeliveryMessages 37
  int32 deliveryId 1
  int64 messageIds 2 array
end

message GetDeliveryGlossary 38
  int32 deliveryId 1
end

message DeliveryGlossary
  property innerMessage=true
  string messages 1 array
end

message GetDeliveryGlossaryResp 39
  DeliveryGlossary glossary 1
end

message ModifyDeliveryGlossary 40
  int32 deliveryId 1
  DeliveryGlossary glossary 2
end

message GetDeliveryState 41
  int32 deliveryId 1
end

message DeliveryStatistics
  property innerMessage=true
  int64 newMessages 1
  int64 processMessage 4
  int64 deliveredMessages 2
  int64 failedMessage 3
  int64 expiredMessages 5
  int64 retriedMessages 6
  int64 sentMessages 7
end

message GetDeliveryStateResp 42
  DeliveryState state 2
  DeliveryStatistics stats 3
end

message DeliveryHistoryItem
  property innerMessage=true
  DeliveryStatus status 1
  string date 2
end

message GetDeliveryHistory 58
  int32 deliveryId 1
end

message GetDeliveryHistoryResp 59
  DeliveryHistoryItem history 1 array
end

enum byte ReqField
  State 1
  Date 2
  Abonent 3
  Text 4
  ErrorCode 5
  UserData 6
end

enum byte DeliveryMessageState
  New       1
  Process   2
  Retry     6
  Delivered 3
  Failed    4
  Expired   5
  Killed    7
end

message RequestMessagesState 43
  int32 deliveryId 1
  DeliveryMessageState states 2 array opt
  string msisdnFilter 7 array opt
  int32 codeFilter 8 array opt
  // DD:MM:YY hh:mm:ss
  string startDate 4
  // DD:MM:YY hh:mm:ss
  string endDate 5
  ReqField fields 6 array
end

message RequestMessagesStateResp 44
  int32 reqId 1
end

message GetNextMessagesPack 45
  int32 reqId 1
  int32 count 2
  int32 timeout 3
end


message MessageInfo
  property innerMessage=true
  int64 id 1
  DeliveryMessageState state 2 opt
  string date 3 opt
  string abonent 4 opt
  string text 5 opt
//  int32 index 8 opt
  int32 errorCode 6 opt
  string userData 7 opt
end

message GetNextMessagesPackResp 46
  bool moreMessages 1
  MessageInfo info 2 array
end

message CountMessages 56
  int32 deliveryId 1
  DeliveryMessageState states 2 array opt
  string msisdnFilter 7 array opt
  int32 codeFilter 8 array opt
  // DD:MM:YY hh:mm:ss
  string startDate 4
  // DD:MM:YY hh:mm:ss
  string endDate 5
end

// NOTE: reqId is 2 to be incompatible with previous protocol version
message CountMessagesResp 57
  int32 reqId 2
end

message CountMessagesPack 62
  int32 reqId 1
  int32 count 2
  int32 timeout 3
end

message CountMessagesPackResp 63
  bool  moreMessages 1
  int32 count 2
end
