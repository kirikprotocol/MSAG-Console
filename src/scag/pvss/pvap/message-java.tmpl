package $var package$;

// import protogen.framework.BufferWriter;
// import protogen.framework.BufferReader;
// import java.io.IOException;

// import org.apache.log4j.Logger;

$macro type$$pack$
$select %1$
$case byte$byte
$case uint16$short
$case uint32$int
$case uint64$long
$case string$String
$case ascii$String
$case utf8$String
$case bool$boolean
$default$$var %1$
$-select$
$-pack$$-macro$

public class $var message.name$ $if options.inheritsFromBatchCmd$ extends BC_CMD$-if$ 
{
    // static Logger logger = Logger.getLogger($var message.name$.class);

$foreach field$
    static final int $var field.name$Tag = $var field.tag$;
$-foreach$

    int seqNum;
$foreach field$
    $expand type field.type$ $var field.name$;
    boolean $var field.name$Flag=false;
$-foreach$

    public $var message.name$() {
    }

    public $var message.name$(int seqNum$pack$
$foreach field$
, $expand type field.type$ $var field.name$
$-foreach$
$-pack$)
    {
        this.seqNum = seqNum;
$foreach field$
        this.$var field.name$ = $var field.name$;
        this.$var field.name$Flag = true;
$-foreach$
    }
  
    public void clear()
    {
$foreach field$
        $var field.name$Flag=false;
$-foreach$
    }
  
    public String toString()
    {
        StringBuilder sb=new StringBuilder();
        sb.append("$var message.name$:");
        sb.append("seqNum=");
        sb.append(seqNum);
$foreach field$
        if ($var field.name$Flag) {
            sb.append(";$var field.name$=");
            $pack$$select field.type$
            $case bool$sb.append($var field.name$);
            $case byte$sb.append($var field.name$);
            $case uint16$sb.append($var field.name$);
            $case uint32$sb.append($var field.name$);
            $case uint64$sb.append($var field.name$);
            $case string$sb.append($var field.name$);
            $case ascii$sb.append($var field.name$);
            $case utf8$sb.append($var field.name$);
            $default$sb.append($var field.name$.toString());
            $-select$$-pack$

        }
$-foreach$
        return sb.toString();
    }
$foreach field$

    public $expand type field.type$ get$var field.name:ucf$()
$if options.throwOnUnsetGet$
           throws FieldIsNullException
$-if$
    {
$if options.throwOnUnsetGet$
        if(!$var field.name$Flag)
        {
            throw new FieldIsNullException("$var field.name$");
        }
$-if$
        return $var field.name$;
    }

    public void set$var field.name:ucf$($expand type field.type$ $var field.name$)
    {
        this.$var field.name$ = $var field.name$;
        this.$var field.name$Flag = true;
    }

    public boolean has$var field.name:ucf$()
    {
        return $var field.name$Flag;
    }
$-foreach$

    public void encode( $var protocol.name:ucf$ proto, IBufferWriter writer ) throws java.io.IOException
    {
        checkFields();
        // mandatory fields
$foreach field$
$if field.mandatory$
        System.out.println("write pos=" + writer.getPos() + " field=" + $var field.name$Tag);
        writer.writeTag($var field.name$Tag);
        $select field.type$
$case string$writer.writeStringLV($var field.name$);
$case ascii$writer.writeUTFLV($var field.name$);
$case utf8$writer.writeUTFLV($var field.name$);
$case byte$writer.writeByteLV($var field.name$);
$case uint16$writer.writeShortLV($var field.name$);
$case uint32$writer.writeIntLV($var field.name$);
$case uint64$writer.writeLongLV($var field.name$);
$case bool$writer.writeBoolLV($var field.name$);
$case nested$throw new NotImplementedException("$var field.name$");
$default$$var field.name$.encode(proto,writer);
$-select$
$-if$
$-foreach$
        // optional fields
$foreach field$
$if field.optional$
        if ($var field.name$Flag) {
            System.out.println("write pos=" + writer.getPos() + " field=" + $var field.name$Tag);
            writer.writeTag($var field.name$Tag);
            $select field.type$
$case string$writer.writeStringLV($var field.name$);
$case ascii$writer.writeUTFLV($var field.name$);
$case utf8$writer.writeUTFLV($var field.name$);
$case byte$writer.writeByteLV($var field.name$);
$case uint16$writer.writeShortLV($var field.name$);
$case uint32$writer.writeIntLV($var field.name$);
$case uint64$writer.writeLongLV($var field.name$);
$case bool$writer.writeBoolLV($var field.name$);
$case nested$throw new NotImplementedException("$var field.name$");
$default$$var field.name$.encode(proto,writer);
$-select$
        }
$-if$
$-foreach$
    }

    public void decode( $var protocol.name:ucf$ proto, IBufferReader reader ) throws java.io.IOException
    {
        clear();
        while( true ) {
            int pos = reader.getPos();
            int tag = reader.readTag();
            System.out.println("read pos=" + pos + " field=" + tag);
            if ( tag == -1 ) break;
            switch( tag ) {
$foreach field$
            case $var field.name$Tag: {
                if ($var field.name$Flag) {
                    throw new DuplicateFieldException("$var field.name$");
                }
                $select field.type$
$case string$$var field.name$=reader.readStringLV();
$case ascii$$var field.name$=reader.readUTFLV();
$case utf8$$var field.name$=reader.readUTFLV();
$case byte$$var field.name$=reader.readByteLV();
$case uint16$$var field.name$=reader.readShortLV();
$case uint32$$var field.name$=reader.readIntLV();
$case uint64$$var field.name$=reader.readLongLV();
$case bool$$var field.name$=reader.readBoolLV();
$case nested$throw new NotImplementedException("$var field.name$");
$default$$var field.name$ = new $var field.type$();
                $var field.name$.decode(proto,reader);
$-select$
                $var field.name$Flag=true;
                break;
            }
$-foreach$
            default:
                throw new NotImplementedException("reaction of reading unknown");
            }
        }
        checkFields();
    }

    public int getSeqNum()
    {
        return seqNum;
    }

    public void setSeqNum(int seqNum)
    {
        this.seqNum = seqNum;
    }

    protected void checkFields() throws MandatoryFieldMissingException
    {
        // checking mandatory fields
$foreach field$
$if field.mandatory$
        if (!$var field.name$Flag) {
            throw new MandatoryFieldMissingException("$var field.name$");
        }
$-if$
$-foreach$
        // checking optional fields
$foreach field$
$if field.optional$
$ifdef field.checkVar$
        if (!$var field.name$Flag
$ifdef field.checkEq$
            && ($var field.checkVar$==$var field.checkEq$)
$-ifdef$
$ifdef field.checkGt$
            && ($var field.checkVar$>$var field.checkGt$)
$-ifdef$
$ifdef field.checkLt$
            && ($var field.checkVar$<$var field.checkLt$)
$-ifdef$
            ) {
            throw new MandatoryFieldMissingException("$var field.name$");
        }
$-ifdef$
$-if$
$-foreach$
    }
}
