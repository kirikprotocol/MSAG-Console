// NOTE: Do NOT edit this file (it is auto-generated).
// Instead, edit message-cpp.tmpl and regenerate.

#ifndef __SCAG_PVSS_PVAP_PC_SET_HPP__
#define __SCAG_PVSS_PVAP_PC_SET_HPP__

#include "util/int.h"
#include <string>
#include "scag/pvss/pvap/Exceptions.h"






// #include "scag/pvss/pvap/TimePolicy.h"
#include "scag/pvss/pvap/TimePolicyFiller.h"





#include "scag/pvss/packets/ProfileRequest.h"
#include "scag/pvss/packets/SetCommand.h"




namespace scag2{
namespace pvss{
namespace pvap{

class PVAP;

class PC_SET
{
protected:
    static const int abonentKeyTag = 3;
    static const int operatorKeyTag = 4;
    static const int providerKeyTag = 5;
    static const int serviceKeyTag = 6;
    static const int varNameTag = 20;
    static const int timePolicyTag = 21;
    static const int intValueTag = 25;
    static const int stringValueTag = 26;
    static const int boolValueTag = 27;
    static const int dateValueTag = 28;

public:
    PC_SET( int seqNum ) :
    owned_(true),
    data_(new ProfileRequest< SetCommand >(new SetCommand(seqNum)))
    {
        profileTypeFlag = false;
        valueTypeFlag = false;
    }

    PC_SET( ProfileRequest< SetCommand >* other ) :
    owned_(false),
    data_(other)
    {
        profileTypeFlag = false;
        valueTypeFlag = false;
    }

    ~PC_SET() {
        if ( data_ && owned_ ) delete data_;
    }

    void clear()
    {
        if ( ! data_ ) return;
        data_->clear();
        profileTypeFlag=false;
        valueTypeFlag=false;
    }

    ProfileRequest< SetCommand >* pop() {
        ProfileRequest< SetCommand >* rv = data_;
        data_ = 0;
        return rv;
    }

    std::string toString() const
    {
        return data_ ? data_->toString() : "";
    }

    template < class DataStream >
        void serialize( const PVAP& proto, DataStream& writer ) const throw (PvapException)
    {
        if ( ! data_ ) return;
        checkFields();
        // mandatory fields
        try {
            // printf( "write pos=%d field=%d\n", ds.getPos(), varNameTag );
            writer.writeTag(varNameTag);
            writer.writeAsciiLV(data_->getCommand()->getVarName());
        } catch ( IOException e ) {
            throw PvapSerializationException( data_->isRequest(),
                                              data_->getSeqNum(),
                                              "writing field varName in PC_SET: %s",
                                              e.what() );
        }
        try {
            // printf( "write pos=%d field=%d\n", ds.getPos(), timePolicyTag );
            writer.writeTag(timePolicyTag);
            {
                TimePolicyFiller helper( data_->getCommand() );
                helper.serialize( proto, writer );
 
            }
        } catch ( IOException e ) {
            throw PvapSerializationException( data_->isRequest(),
                                              data_->getSeqNum(),
                                              "writing field timePolicy in PC_SET: %s",
                                              e.what() );
        }
        // optional fields
        if ( data_->getProfileKey().hasAbonentKey() ) {
            // printf( "write pos=%d field=%d\n", writer.getPos(), abonentKeyTag );
            try {
                writer.writeTag(abonentKeyTag);
                writer.writeAsciiLV(data_->getProfileKey().getAbonentKey());
            } catch ( IOException e ) {
                throw PvapSerializationException( data_->isRequest(),
                                                  data_->getSeqNum(),
                                                  "writing field abonentKey in PC_SET:",
                                                  e.what() );
            }
        }
        if ( data_->getProfileKey().hasOperatorKey() ) {
            // printf( "write pos=%d field=%d\n", writer.getPos(), operatorKeyTag );
            try {
                writer.writeTag(operatorKeyTag);
                writer.writeIntLV(data_->getProfileKey().getOperatorKey());
            } catch ( IOException e ) {
                throw PvapSerializationException( data_->isRequest(),
                                                  data_->getSeqNum(),
                                                  "writing field operatorKey in PC_SET:",
                                                  e.what() );
            }
        }
        if ( data_->getProfileKey().hasProviderKey() ) {
            // printf( "write pos=%d field=%d\n", writer.getPos(), providerKeyTag );
            try {
                writer.writeTag(providerKeyTag);
                writer.writeIntLV(data_->getProfileKey().getProviderKey());
            } catch ( IOException e ) {
                throw PvapSerializationException( data_->isRequest(),
                                                  data_->getSeqNum(),
                                                  "writing field providerKey in PC_SET:",
                                                  e.what() );
            }
        }
        if ( data_->getProfileKey().hasServiceKey() ) {
            // printf( "write pos=%d field=%d\n", writer.getPos(), serviceKeyTag );
            try {
                writer.writeTag(serviceKeyTag);
                writer.writeIntLV(data_->getProfileKey().getServiceKey());
            } catch ( IOException e ) {
                throw PvapSerializationException( data_->isRequest(),
                                                  data_->getSeqNum(),
                                                  "writing field serviceKey in PC_SET:",
                                                  e.what() );
            }
        }
        if ( data_->getCommand()->hasIntValue() ) {
            // printf( "write pos=%d field=%d\n", writer.getPos(), intValueTag );
            try {
                writer.writeTag(intValueTag);
                writer.writeIntLV(data_->getCommand()->getIntValue());
            } catch ( IOException e ) {
                throw PvapSerializationException( data_->isRequest(),
                                                  data_->getSeqNum(),
                                                  "writing field intValue in PC_SET:",
                                                  e.what() );
            }
        }
        if ( data_->getCommand()->hasStringValue() ) {
            // printf( "write pos=%d field=%d\n", writer.getPos(), stringValueTag );
            try {
                writer.writeTag(stringValueTag);
                writer.writeUTFLV(data_->getCommand()->getStringValue());
            } catch ( IOException e ) {
                throw PvapSerializationException( data_->isRequest(),
                                                  data_->getSeqNum(),
                                                  "writing field stringValue in PC_SET:",
                                                  e.what() );
            }
        }
        if ( data_->getCommand()->hasBoolValue() ) {
            // printf( "write pos=%d field=%d\n", writer.getPos(), boolValueTag );
            try {
                writer.writeTag(boolValueTag);
                writer.writeBoolLV(data_->getCommand()->getBoolValue());
            } catch ( IOException e ) {
                throw PvapSerializationException( data_->isRequest(),
                                                  data_->getSeqNum(),
                                                  "writing field boolValue in PC_SET:",
                                                  e.what() );
            }
        }
        if ( data_->getCommand()->hasDateValue() ) {
            // printf( "write pos=%d field=%d\n", writer.getPos(), dateValueTag );
            try {
                writer.writeTag(dateValueTag);
                writer.writeIntLV(data_->getCommand()->getDateValue());
            } catch ( IOException e ) {
                throw PvapSerializationException( data_->isRequest(),
                                                  data_->getSeqNum(),
                                                  "writing field dateValue in PC_SET:",
                                                  e.what() );
            }
        }
    }

    template <class DataStream> void deserialize( PVAP& proto, DataStream& reader )
        throw (PvapException)
    {
        if ( ! data_ ) return;
        clear();
        int tag = -1;
        try {
            do {
                // int pos = int(reader.getPos());
                tag = reader.readTag();
                // printf( "read pos=%d field=%d\n", pos, tag );
                if ( tag == -1 ) break;
                switch(tag) {
                case abonentKeyTag: {
                    if (profileTypeFlag) {
                        throw DuplicateFieldException(data_->isRequest(),
                                                      "duplicate field abonentKey of PC_SET", data_->getSeqNum());
                    }
                    profileTypeFlag = true;
                    data_->getProfileKey().setAbonentKey(reader.readAsciiLV());
                    break;
                }
                case operatorKeyTag: {
                    if (profileTypeFlag) {
                        throw DuplicateFieldException(data_->isRequest(),
                                                      "duplicate field operatorKey of PC_SET", data_->getSeqNum());
                    }
                    profileTypeFlag = true;
                    data_->getProfileKey().setOperatorKey(reader.readIntLV());
                    break;
                }
                case providerKeyTag: {
                    if (profileTypeFlag) {
                        throw DuplicateFieldException(data_->isRequest(),
                                                      "duplicate field providerKey of PC_SET", data_->getSeqNum());
                    }
                    profileTypeFlag = true;
                    data_->getProfileKey().setProviderKey(reader.readIntLV());
                    break;
                }
                case serviceKeyTag: {
                    if (profileTypeFlag) {
                        throw DuplicateFieldException(data_->isRequest(),
                                                      "duplicate field serviceKey of PC_SET", data_->getSeqNum());
                    }
                    profileTypeFlag = true;
                    data_->getProfileKey().setServiceKey(reader.readIntLV());
                    break;
                }
                case varNameTag: {
                    data_->getCommand()->setVarName(reader.readAsciiLV());
                    break;
                }
                case timePolicyTag: {
                    TimePolicyFiller helper(data_->getCommand());
                    helper.deserialize(proto,reader);
                    break;
                }
                case intValueTag: {
                    if (valueTypeFlag) {
                        throw DuplicateFieldException(data_->isRequest(),
                                                      "duplicate field intValue of PC_SET", data_->getSeqNum());
                    }
                    valueTypeFlag = true;
                    data_->getCommand()->setIntValue(reader.readIntLV());
                    break;
                }
                case stringValueTag: {
                    if (valueTypeFlag) {
                        throw DuplicateFieldException(data_->isRequest(),
                                                      "duplicate field stringValue of PC_SET", data_->getSeqNum());
                    }
                    valueTypeFlag = true;
                    data_->getCommand()->setStringValue(reader.readUTFLV());
                    break;
                }
                case boolValueTag: {
                    if (valueTypeFlag) {
                        throw DuplicateFieldException(data_->isRequest(),
                                                      "duplicate field boolValue of PC_SET", data_->getSeqNum());
                    }
                    valueTypeFlag = true;
                    data_->getCommand()->setBoolValue(reader.readBoolLV());
                    break;
                }
                case dateValueTag: {
                    if (valueTypeFlag) {
                        throw DuplicateFieldException(data_->isRequest(),
                                                      "duplicate field dateValue of PC_SET", data_->getSeqNum());
                    }
                    valueTypeFlag = true;
                    data_->getCommand()->setDateValue(reader.readIntLV());
                    break;
                }
                default:
                    throw InvalidFieldTypeException(data_->isRequest(),"invalid field in PC_SET", data_->getSeqNum(),tag);
                }
            } while ( true );
        } catch ( IOException e ) {
            throw PvapSerializationException( data_->isRequest(),
                                              data_->getSeqNum(),
                                              "reading field tag=%d of PC_SET: %s",
                                              tag, e.what() );
        }
        checkFields();
    }

    uint32_t getSeqNum() const {
        return data_ ? data_->getSeqNum() : uint32_t(-1);
    }

protected:
    void checkFields() const throw (PvapException)
    {
        // using parent check
        if ( !data_->isValid() ) {
            throw MessageIsBrokenException(data_->isRequest(), "message PC_SET is broken: " + toString(), data_->getSeqNum() );
        }
    }

private:
    PC_SET( const PC_SET& );
    PC_SET& operator = ( const PC_SET& );

protected:
    //static const uint8_t versionMajor=2;
    //static const uint8_t versionMinor=0;

    bool                owned_;
    ProfileRequest< SetCommand >* data_;
    uint8_t profileType;
    uint8_t valueType;

    bool profileTypeFlag;
    bool valueTypeFlag;
};

} // namespace scag2
} // namespace pvss
} // namespace pvap
#endif
