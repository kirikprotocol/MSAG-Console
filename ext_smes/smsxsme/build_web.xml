<project name="smsx_web_stats" default="exploded">


  <property name="build.dir" value=".build_web"/>


  <property name="tests.dir" value="${build.dir}/test"/>

  <property name="source.classes" value="${build.dir}/classes"/>

  <property name="test.classes" value="${build.dir}/test_classes"/>

  <property name="exploded.dir" value="${build.dir}/exploded"/>

  <property name="smsc.src.dir" value="../../webapps/smsc/WEB-INF/src/"/>
  <property name="smsc.libs.dir" value="../../webapps/libs"/>


  <path id="lib">
    <fileset dir="web_lib" includes="*.jar"/>
  </path>

  <path id="smsc_lib">
    <fileset dir="${smsc.libs.dir}" includes="*.jar"/>
  </path>




  <target name="compile.sources">
    <delete dir="${source.classes}" failonerror="false"/>
    <mkdir dir="${source.classes}"/>
    <javac srcdir="websrc" destdir="${source.classes}" debug="true" source="1.4">
      <sourcepath path="${smsc.src.dir}"/>
      <classpath refid="lib"/>
      <classpath refid="smsc_lib"/>
    </javac>
  </target>


  <target name="compile.tests" depends="compile.sources">
    <delete dir="${test.classes}" failonerror="false"/>
    <mkdir dir="${test.classes}"/>
    <copy todir="${test.classes}">
      <fileset dir="${source.classes}"/>
    </copy>
    <javac srcdir="web_test" destdir="${test.classes}" classpathref="lib" debug="true" source="1.4"/>
  </target>

  <target name="test" depends="compile.tests">
    <delete dir="${tests.dir}" failonerror="false"/>
    <mkdir dir="${tests.dir}"/>

    <junit showoutput="true" printsummary="yes" fork="true">
      <classpath path="${test.classes}"/>
      <classpath refid="lib"/>

      <formatter type="xml" usefile="true"/>
      <batchtest todir="${tests.dir}">
        <fileset dir="${test.classes}" includes="**/*Test.class"/>
      </batchtest>
    </junit>
  </target>


  <target name="exploded" depends="test">
    <delete dir="${exploded.dir}" failonerror="false"/>
    <mkdir dir="${exploded.dir}"/>
    <copy todir="${exploded.dir}">
      <fileset dir="web" includes="**/*"/>
    </copy>

    <mkdir dir="${exploded.dir}/WEB-INF/lib"/>
    <jar destfile="${exploded.dir}/WEB-INF/lib/smsx_stat.jar" basedir="${source.classes}" excludes="ru/novosoft/**"/>
  </target>


</project>