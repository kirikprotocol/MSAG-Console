package mobi.eyeline.mcaia.protocol;

import mobi.eyeline.protogen.framework.*;
import java.io.IOException;

/**
 * This class generated by protogen
 * This protocol has header: len (4 oct), tag (4 oct), seq (4 oct), message body
 */
public class ClientProtocol {
/*  public static interface Handler {
    public void handle( PDU object );
  }

  Handler handler;
  public ClientProtocol(Handler handler) {
    this.handler = handler;
  }*/

  /*
    reader should contain buffer WITHOUT length!!!
  */
  public static PDU decodeMessage( BufferReader reader ) throws IOException {
    int tag = reader.readInt();
    int seq = reader.readInt();
    ClientProtocolTag t = ClientProtocolTag.valueOf(tag);
    if( t == null ) throw new InvalidMessageTypeException();
    PDU pdu = t.createPdu();
    pdu.setSeqNum(seq);
    pdu.decode( reader );
//    handler.handle(pdu);
    return pdu;
  }

  public static void encodeMessage( BufferWriter writer, PDU pdu) throws IOException {
    int pos = writer.getLength();
    writer.writeInt(0); // write 4 bytes for future length
    writer.writeInt(pdu.getTag());
    writer.writeInt(pdu.getSeqNum());
    pdu.encode(writer);
    writer.replaceInt( pos, writer.getLength()-pos-4 ); // fill first 4 bytes with actual length
  }
}
