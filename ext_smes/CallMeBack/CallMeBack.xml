<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="CallMeBack" default="all">
   <!-- Uncomment the following property if no tests compilation is needed -->
   <!-- <property name="skip.tests" value="true"/> -->
   <!-- Compiler options -->
   <property name="compiler.debug" value="on"/>
   <property name="compiler.generate.no.warnings" value="off"/>
   <property name="compiler.args" value=""/>
   <property name="compiler.max.memory" value="128m"/>
   <patternset id="compiler.excluded"/>
   <patternset id="compiler.resources">
      <include name="**/?*.properties"/>
      <include name="**/?*.xml"/>
      <include name="**/?*.html"/>
      <include name="**/?*.gif"/>
      <include name="**/?*.png"/>
      <include name="**/?*.jpeg"/>
      <include name="**/?*.jpg"/>
   </patternset>
   <!-- JDK definitions -->
   <!-- Project Libraries -->
   <!-- Global Libraries -->
   <dirname property="module.CallMeBack.basedir" file="${ant.file}"/>
   <property name="compiler.args.CallMeBack" value="${compiler.args}"/>
   <property name="CallMeBack.output.dir" value="${module.CallMeBack.basedir}/classes"/>
   <property name="CallMeBack.testoutput.dir" value="${module.CallMeBack.basedir}/classes"/>
   <path id="CallMeBack.module.bootclasspath">
      <!-- Paths to be included in compilation bootclasspath -->
   </path>
   <path id="CallMeBack.module.classpath">
      <pathelement location="${module.CallMeBack.basedir}/lib/connpool.jar"/>
      <pathelement location="${module.CallMeBack.basedir}/lib/jsmppapi.jar"/>
      <pathelement location="${module.CallMeBack.basedir}/lib/log4j.jar"/>
      <pathelement location="${module.CallMeBack.basedir}/lib/sme.jar"/>
      <pathelement location="${module.CallMeBack.basedir}/lib/tpool.jar"/>
      <pathelement location="${module.CallMeBack.basedir}/config"/>
      <!--path refid="${module.jdk.classpath.CallMeBack}"/-->
   </path>
   <patternset id="excluded.from.module.CallMeBack"/>
   <patternset id="excluded.from.compilation.CallMeBack">
      <patternset refid="excluded.from.module.CallMeBack"/>
      <patternset refid="compiler.excluded"/>
   </patternset>
   <path id="CallMeBack.module.sourcepath">
      <dirset dir="${module.CallMeBack.basedir}">
         <include name="src"/>
      </dirset>
   </path>

   <target name="jar" depends="compile" description="create JAR file">
      <copy file="${module.CallMeBack.basedir}/history.txt" todir="${CallMeBack.output.dir}"/>
      <jar basedir="${CallMeBack.output.dir}" destfile="${module.CallMeBack.basedir}/lib/cmb.jar" manifest="${module.CallMeBack.basedir}/manifest.mf">
         <exclude name=".dependency-info/**"/>
      </jar>
      <delete file="${CallMeBack.output.dir}/history.txt"/>
   </target>

   <target name="compile" depends="compile.module.CallMeBack.production,compile.module.CallMeBack.tests" description="compile module CallMeBack"/>

   <target name="compile.module.CallMeBack.production" description="compile module CallMeBack production classes">
      <mkdir dir="${CallMeBack.output.dir}"/>
      <javac destdir="${CallMeBack.output.dir}" debug="${compiler.debug}" nowarn="${compiler.generate.no.warnings}" memoryMaximumSize="${compiler.max.memory}" fork="true">
         <compilerarg line="${compiler.args.CallMeBack}"/>
         <bootclasspath refid="CallMeBack.module.bootclasspath"/>
         <classpath refid="CallMeBack.module.classpath"/>
         <src refid="CallMeBack.module.sourcepath"/>
         <patternset refid="excluded.from.compilation.CallMeBack"/>
      </javac>
      <copy todir="${CallMeBack.output.dir}">
         <fileset dir="${module.CallMeBack.basedir}/src">
            <patternset refid="compiler.resources"/>
            <type type="file"/>
            <patternset refid="excluded.from.compilation.CallMeBack"/>
         </fileset>
      </copy>
   </target>

   <target name="compile.module.CallMeBack.tests" depends="compile.module.CallMeBack.production" description="compile module CallMeBack test classes" unless="skip.tests"/>

   <target name="clean.module.CallMeBack" description="cleanup module">
      <delete dir="${CallMeBack.output.dir}"/>
      <delete dir="${CallMeBack.testoutput.dir}"/>
   </target>

   <target name="init" description="Build initialization">
      <!-- Perform any build initialization in this target -->
   </target>

   <!-- obfuscate -->
   <target name="obfuscate">
      <taskdef name="obfuscate" classname="com.yworks.yguard.ObfuscatorTask" classpath="lib/yguard.jar"/>
      <obfuscate mainclass="ru.sibinco.smpp.CallMeBack" logfile="obfuscate.log" replaceclassnamestrings="true">
         <property name="error-checking" value="pedantic"/>
         <inoutpair in="lib/cmb.jar" out="lib/cmb.jar"/>
         <externalclasses>
            <pathelement location="lib/jsmppapi.jar"/>
            <pathelement location="lib/sme.jar"/>
         </externalclasses>
         <expose>
            <class classes="protected" methods="protected" fields="protected"></class>
         </expose>
      </obfuscate>
   </target>

   <target name="clean" depends="clean.module.CallMeBack" description="cleanup all"/>

   <target name="all" depends="init, clean, compile, jar" description="build all"/>
</project>